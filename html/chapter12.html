<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第12章：流体仿真基础</title>
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="stylesheet" href="./assets/highlight.css">
    <script src="./assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <ul class="nav-list"><li class=""><a href="./index.html">3D打印中的数学原理与计算方法</a></li><li class=""><a href="./chapter1.html">第1章：几何表示与变换</a></li><li class=""><a href="./chapter2.html">第2章：微分几何与离散算子</a></li><li class=""><a href="./chapter3.html">第3章：计算共形几何</a></li><li class=""><a href="./chapter4.html">第4章：计算拓扑与同调</a></li><li class=""><a href="./chapter5.html">第5章：网格处理算法</a></li><li class=""><a href="./chapter6.html">第6章：有限元方法与结构分析</a></li><li class=""><a href="./chapter7.html">第7章：拓扑优化基础</a></li><li class=""><a href="./chapter8.html">第8章：高级拓扑优化</a></li><li class=""><a href="./chapter9.html">第9章：切片算法与支撑生成</a></li><li class=""><a href="./chapter10.html">第10章：路径规划与填充</a></li><li class=""><a href="./chapter11.html">第11章：误差分析与补偿</a></li><li class="active"><a href="./chapter12.html">第12章：流体仿真基础</a></li><li class=""><a href="./chapter13.html">第13章：多相流与传热</a></li><li class=""><a href="./chapter14.html">第14章：多视图几何</a></li><li class=""><a href="./chapter15.html">第15章：神经隐式表示</a></li><li class=""><a href="./chapter16.html">第16章：3D Gaussian Splatting</a></li><li class=""><a href="./chapter17.html">第17章：可微渲染基础</a></li><li class=""><a href="./chapter18.html">第18章：高级可微渲染与逆向问题</a></li><li class=""><a href="./chapter19.html">第19章：符号几何与程序化建模</a></li><li class=""><a href="./chapter20.html">第20章：神经程序合成</a></li><li class=""><a href="./chapter21.html">第21章：深度生成模型</a></li><li class=""><a href="./chapter22.html">第22章：形状分析与检索</a></li><li class=""><a href="./chapter23.html">第23章：多材料与4D打印</a></li><li class=""><a href="./chapter24.html">第24章：仿生设计与自然算法</a></li><li class=""><a href="./chapter25.html">第25章：逆向问题与参数估计</a></li><li class=""><a href="./chapter26.html">第26章：实时仿真与数字孪生</a></li><li class=""><a href="./chapter27.html">第27章：常用工具与库</a></li><li class=""><a href="./CLAUDE.html">Untitled</a></li></ul>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="12">第12章：流体仿真基础</h1>
<p>本章深入探讨计算流体动力学（CFD）在3D打印中的应用，特别是熔融材料流动、喷射过程和冷却凝固的数学建模。我们将从连续介质力学的Navier-Stokes方程出发，介绍多种离散化方法和数值求解技术，重点关注3D打印特有的多相流、相变和自由表面问题。通过本章学习，读者将掌握流体仿真的核心数学原理，理解不同数值方法的优缺点，并能够针对具体的3D打印工艺选择合适的仿真策略。</p>
<h2 id="121-navier-stokesreynolds">12.1 Navier-Stokes方程与Reynolds数</h2>
<h3 id="1211">12.1.1 连续介质假设与守恒定律</h3>
<p>在3D打印的流体仿真中，我们通常将熔融材料视为连续介质。这一假设在Knudsen数 $Kn = \lambda/L \ll 1$ 时成立，其中 $\lambda$ 是分子平均自由程，$L$ 是特征长度。对于大多数3D打印工艺（FDM、SLA、SLS），这一假设是合理的。</p>
<p><strong>Knudsen数的物理意义与流动分类</strong>：</p>
<ul>
<li>$Kn &lt; 0.001$：连续流（Navier-Stokes方程适用）</li>
<li>$0.001 &lt; Kn &lt; 0.1$：滑移流（需要滑移边界条件）</li>
<li>$0.1 &lt; Kn &lt; 10$：过渡流（需要Boltzmann方程）</li>
<li>$Kn &gt; 10$：自由分子流（分子动力学）</li>
</ul>
<p>在典型的FDM打印中，喷嘴直径 $L \sim 0.4$ mm，聚合物熔体的分子平均自由程 $\lambda \sim 10^{-9}$ m，因此 $Kn \sim 10^{-6} \ll 1$，连续介质假设完全成立。</p>
<p>流体运动遵循三大守恒定律，这些定律可以从Reynolds输运定理统一推导：</p>
<p><strong>Reynolds输运定理</strong>：
对于任意广延量 $\Phi$，其在随流体运动的物质体积 $V(t)$ 中的变化率：
$$\frac{D}{Dt}\int_{V(t)} \phi \rho dV = \int_{V} \frac{\partial(\rho\phi)}{\partial t} dV + \oint_{\partial V} \rho\phi(\mathbf{u} \cdot \mathbf{n})dA$$
其中 $\phi$ 是单位质量的广延量密度。</p>
<p><strong>质量守恒（连续性方程）</strong>：
取 $\phi = 1$，由于质量不生不灭：
$$\frac{D}{Dt}\int_{V(t)} \rho dV = 0$$
应用Reynolds输运定理和散度定理：
$$\frac{\partial \rho}{\partial t} + \nabla \cdot (\rho \mathbf{u}) = 0$$
对于不可压缩流体（$D\rho/Dt = 0$），简化为：
$$\nabla \cdot \mathbf{u} = 0$$
这个条件在3D打印熔融聚合物中通常满足，因为压力变化引起的密度变化 $\Delta\rho/\rho \sim \Delta p/K \ll 1$，其中 $K$ 是体积模量。</p>
<p><strong>动量守恒（Cauchy动量方程）</strong>：
取 $\phi = \mathbf{u}$，根据牛顿第二定律：
$$\frac{D}{Dt}\int_{V(t)} \rho\mathbf{u} dV = \int_V \rho\mathbf{g} dV + \oint_{\partial V} \mathbf{t} dA$$
其中 $\mathbf{t} = \boldsymbol{\sigma} \cdot \mathbf{n}$ 是应力矢量。将Cauchy应力张量分解为：
$$\boldsymbol{\sigma} = -p\mathbf{I} + \boldsymbol{\tau}$$
得到微分形式：
$$\rho \frac{D\mathbf{u}}{Dt} = -\nabla p + \nabla \cdot \boldsymbol{\tau} + \rho \mathbf{g}$$
其中物质导数展开为：
$$\frac{D\mathbf{u}}{Dt} = \frac{\partial \mathbf{u}}{\partial t} + (\mathbf{u} \cdot \nabla)\mathbf{u}$$
<strong>能量守恒（热力学第一定律）</strong>：
取 $\phi = e + \frac{1}{2}|\mathbf{u}|^2$（内能+动能），考虑热传导和做功：
$$\rho \frac{De}{Dt} = -p(\nabla \cdot \mathbf{u}) + \boldsymbol{\tau}:\nabla\mathbf{u} + \nabla \cdot (k\nabla T) + Q$$
对于不可压缩流体，使用焓形式更方便：
$$\rho c_p \frac{DT}{Dt} = \nabla \cdot (k \nabla T) + \Phi + Q$$
其中粘性耗散函数：
$$\Phi = \boldsymbol{\tau}:\nabla\mathbf{u} = 2\mu\mathbf{S}:\mathbf{S}$$
在3D打印中，$\Phi$ 在高剪切率区域（如喷嘴出口）可能显著，导致局部温升。</p>
<h3 id="1212-navier-stokes">12.1.2 不可压缩Navier-Stokes方程推导</h3>
<p><strong>牛顿流体本构关系</strong>：
牛顿流体的本构方程建立在线性粘性假设上，即应力与应变率成正比。最一般的各向同性线性关系：
$$\boldsymbol{\tau} = 2\mu \mathbf{S} + \lambda (\nabla \cdot \mathbf{u}) \mathbf{I}$$
其中 $\mu$ 是动力粘度（剪切粘度），$\lambda$ 是第二粘度系数（体积粘度相关）。应变率张量定义为速度梯度张量的对称部分：
$$\mathbf{S} = \frac{1}{2}(\nabla \mathbf{u} + \nabla \mathbf{u}^T) = \frac{1}{2}(\partial_i u_j + \partial_j u_i)$$
<strong>Stokes假设</strong>：
对于单原子气体，Stokes提出：
$$\lambda + \frac{2}{3}\mu = 0$$
这使得粘性应力张量的迹为零：$\text{tr}(\boldsymbol{\tau}) = 0$。虽然这个假设对多原子气体和液体并不严格成立，但在不可压缩流中自动满足。</p>
<p><strong>不可压缩流的简化</strong>：
对于不可压缩流体（$\nabla \cdot \mathbf{u} = 0$），粘性应力张量简化为：
$$\boldsymbol{\tau} = 2\mu \mathbf{S}$$
代入动量方程：
$$\rho \frac{D\mathbf{u}}{Dt} = -\nabla p + \nabla \cdot (2\mu \mathbf{S}) + \rho \mathbf{g}$$
对于常粘度流体，利用恒等式：
$$\nabla \cdot (2\mu \mathbf{S}) = \mu \nabla \cdot (\nabla \mathbf{u} + \nabla \mathbf{u}^T) = \mu(\nabla^2 \mathbf{u} + \nabla(\nabla \cdot \mathbf{u}))$$
在不可压缩条件下，第二项消失，得到：
$$\rho \left(\frac{\partial \mathbf{u}}{\partial t} + \mathbf{u} \cdot \nabla \mathbf{u}\right) = -\nabla p + \mu \nabla^2 \mathbf{u} + \rho \mathbf{g}$$
这就是著名的不可压缩Navier-Stokes方程。配合连续性方程：
$$\nabla \cdot \mathbf{u} = 0$$
构成了描述不可压缩粘性流动的完整方程组（4个方程，4个未知数：$u, v, w, p$）。</p>
<p><strong>非牛顿流体模型</strong>：
在3D打印中，熔融聚合物通常表现为非牛顿流体。常见模型包括：</p>
<ol>
<li><strong>幂律模型（Power-Law）</strong>：
$$\boldsymbol{\tau} = 2K|\dot{\gamma}|^{n-1} \mathbf{S}$$
其中 $K$ 是稠度系数，$n$ 是幂律指数，$\dot{\gamma} = \sqrt{2\mathbf{S}:\mathbf{S}}$ 是广义剪切率。</li>
</ol>
<ul>
<li>$n &lt; 1$：剪切变稀（大多数聚合物熔体）</li>
<li>$n = 1$：牛顿流体</li>
<li>$n &gt; 1$：剪切增稠（某些填充材料）</li>
</ul>
<ol start="2">
<li>
<p><strong>Carreau-Yasuda模型</strong>（更准确描述宽剪切率范围）：
$$\eta = \eta_\infty + (\eta_0 - \eta_\infty)[1 + (\lambda\dot{\gamma})^a]^{(n-1)/a}$$
其中 $\eta_0$ 是零剪切粘度，$\eta_\infty$ 是无限剪切粘度，$\lambda$ 是时间常数，$a$ 是Yasuda参数。</p>
</li>
<li>
<p><strong>Cross模型</strong>（数值更稳定）：
$$\eta = \eta_\infty + \frac{\eta_0 - \eta_\infty}{1 + (K\dot{\gamma})^m}$$</p>
</li>
<li>
<p><strong>粘弹性模型</strong>（考虑弹性效应）：
对于挤出胀大等现象，需要考虑弹性，如Oldroyd-B模型：
$$\boldsymbol{\tau} + \lambda_1 \stackrel{\nabla}{\boldsymbol{\tau}} = 2\eta_0(\mathbf{D} + \lambda_2 \stackrel{\nabla}{\mathbf{D}})$$
其中 $\stackrel{\nabla}{\boldsymbol{\tau}}$ 是上随体导数。</p>
</li>
</ol>
<h3 id="1213-reynolds">12.1.3 无量纲化与Reynolds数的物理意义</h3>
<p><strong>无量纲化的系统方法</strong>：
通过选择特征尺度进行无量纲化，可以识别控制流动的关键参数并简化问题。选择特征量：</p>
<ul>
<li>特征长度：$L$（如喷嘴直径、液滴直径）</li>
<li>特征速度：$U$（如挤出速度、喷射速度）</li>
<li>特征时间：$L/U$（对流时间尺度）</li>
<li>特征压力：$\rho U^2$（动压）或 $\mu U/L$（粘性压力尺度）</li>
</ul>
<p>定义无量纲变量：
$$\mathbf{x}^* = \frac{\mathbf{x}}{L}, \quad \mathbf{u}^* = \frac{\mathbf{u}}{U}, \quad t^* = \frac{tU}{L}, \quad p^* = \frac{p}{\rho U^2}$$
代入Navier-Stokes方程：
$$\rho U^2 \frac{1}{L}\left(\frac{\partial \mathbf{u}^*}{\partial t^*} + \mathbf{u}^* \cdot \nabla^* \mathbf{u}^*\right) = -\frac{\rho U^2}{L}\nabla^* p^* + \frac{\mu U}{L^2} \nabla^{*2} \mathbf{u}^* + \rho \mathbf{g}$$
除以 $\rho U^2/L$：
$$\frac{\partial \mathbf{u}^*}{\partial t^*} + \mathbf{u}^* \cdot \nabla^* \mathbf{u}^* = -\nabla^* p^* + \frac{1}{Re} \nabla^{*2} \mathbf{u}^* + \frac{1}{Fr^2} \hat{\mathbf{g}}$$
<strong>关键无量纲数</strong>：</p>
<ol>
<li>
<p><strong>Reynolds数</strong>：$Re = \frac{\rho UL}{\mu} = \frac{\text{惯性力}}{\text{粘性力}}$
   - 物理意义：动量扩散时间与对流时间之比
   - $Re \ll 1$：粘性主导（Stokes流）
   - $Re \sim 1$：惯性与粘性平衡
   - $Re \gg 1$：惯性主导（可能湍流）</p>
</li>
<li>
<p><strong>Froude数</strong>：$Fr = \frac{U}{\sqrt{gL}}$
   - 物理意义：惯性力与重力之比
   - 在垂直喷射中重要</p>
</li>
<li>
<p><strong>Strouhal数</strong>：$St = \frac{fL}{U}$（$f$ 是特征频率）
   - 描述非定常效应的重要性
   - 液滴形成频率分析</p>
</li>
<li>
<p><strong>Capillary数</strong>：$Ca = \frac{\mu U}{\sigma}$
   - 粘性力与表面张力之比
   - 液滴形成和破碎的关键参数</p>
</li>
<li>
<p><strong>Weber数</strong>：$We = \frac{\rho U^2 L}{\sigma}$
   - 惯性力与表面张力之比
   - $We = Re \cdot Ca$</p>
</li>
<li>
<p><strong>Ohnesorge数</strong>：$Oh = \frac{\mu}{\sqrt{\rho \sigma L}} = \frac{\sqrt{We}}{Re}$
   - 粘性力与惯性-表面张力之比
   - 液滴形成模式分类</p>
</li>
</ol>
<p><strong>3D打印中的流动regime</strong>：</p>
<p>| 工艺 | 典型Re | 流动特征 | 主导物理 |</p>
<table>
<thead>
<tr>
<th>工艺</th>
<th>典型Re</th>
<th>流动特征</th>
<th>主导物理</th>
</tr>
</thead>
<tbody>
<tr>
<td>FDM挤出</td>
<td>0.01-1</td>
<td>Stokes流</td>
<td>粘性、压力梯度</td>
</tr>
<tr>
<td>喷墨打印</td>
<td>10-100</td>
<td>层流射流</td>
<td>表面张力、惯性</td>
</tr>
<tr>
<td>SLA树脂流动</td>
<td>0.1-10</td>
<td>爬流</td>
<td>粘性、毛细力</td>
</tr>
<tr>
<td>金属熔池</td>
<td>100-1000</td>
<td>对流主导</td>
<td>Marangoni效应、浮力</td>
</tr>
<tr>
<td>粉末床气流</td>
<td>1000-10000</td>
<td>湍流可能</td>
<td>惯性、湍流混合</td>
</tr>
</tbody>
</table>
<p><strong>渐近分析</strong>：</p>
<ol>
<li>
<p><strong>低Reynolds数极限</strong>（$Re \to 0$）：
忽略惯性项，得到线性Stokes方程：
$$\nabla p = \mu \nabla^2 \mathbf{u}$$
$$\nabla \cdot \mathbf{u} = 0$$
解具有可逆性（Stokes悖论）和瞬时响应特性。</p>
</li>
<li>
<p><strong>高Reynolds数极限</strong>（$Re \to \infty$）：
边界层理论（Prandtl, 1904）：</p>
</li>
</ol>
<ul>
<li>外部无粘流：$\nabla p \sim \rho U^2/L$</li>
<li>边界层厚度：$\delta \sim L/\sqrt{Re}$</li>
<li>边界层内：粘性与惯性平衡</li>
</ul>
<ol start="3">
<li><strong>Oseen修正</strong>（$Re \sim 1$）：
对Stokes流的惯性修正：
$$\rho U \frac{\partial u_i}{\partial x_1} = -\frac{\partial p}{\partial x_i} + \mu \nabla^2 u_i$$</li>
</ol>
<h3 id="1214">12.1.4 边界条件与初始条件</h3>
<p>正确的边界条件对CFD仿真至关重要。3D打印中常见的边界条件：</p>
<p><strong>固壁边界</strong>：</p>
<ul>
<li>无滑移条件：$\mathbf{u} = \mathbf{0}$（静止壁面）或 $\mathbf{u} = \mathbf{u}_{\text{wall}}$（移动壁面）</li>
<li>滑移条件（用于微尺度流动）：$u_{\parallel} = L_s \frac{\partial u_{\parallel}}{\partial n}$</li>
</ul>
<p><strong>入口边界</strong>：</p>
<ul>
<li>速度入口：$\mathbf{u} = \mathbf{u}_{\text{in}}(\mathbf{x}, t)$</li>
<li>压力入口：$p = p_{\text{in}}$</li>
<li>质量流率：$\int_{\Gamma_{\text{in}}} \rho \mathbf{u} \cdot \mathbf{n} \, dA = \dot{m}$</li>
</ul>
<p><strong>出口边界</strong>：</p>
<ul>
<li>压力出口：$p = p_{\text{out}}$（通常取大气压）</li>
<li>完全发展流：$\frac{\partial \mathbf{u}}{\partial n} = \mathbf{0}$</li>
<li>对流边界：$\frac{\partial \mathbf{u}}{\partial t} + c \frac{\partial \mathbf{u}}{\partial n} = 0$</li>
</ul>
<p><strong>自由表面</strong>（气液界面）：</p>
<ul>
<li>运动学条件：$\frac{D(\mathbf{x} - \mathbf{x}_s)}{Dt} = 0$</li>
<li>动力学条件：$[\mathbf{n} \cdot \boldsymbol{\sigma} \cdot \mathbf{n}]_{\text{gas}}^{\text{liquid}} = \sigma \kappa$</li>
</ul>
<p>其中 $\sigma$ 是表面张力系数，$\kappa$ 是界面曲率。</p>
<h3 id="1215">12.1.5 解的存在性与唯一性</h3>
<p>Navier-Stokes方程的数学理论是千禧年七大难题之一。对于3D打印仿真，我们关注实用的结论：</p>
<p><strong>2D情况</strong>：存在唯一的全局弱解（Leray, 1934）。</p>
<p><strong>3D情况</strong>：</p>
<ul>
<li>小初值或短时间：存在唯一的强解</li>
<li>一般情况：存在弱解（可能不唯一）</li>
</ul>
<p><strong>Stokes流</strong>（$Re \ll 1$）：线性问题，存在唯一解。</p>
<p>对于数值求解，我们需要考虑：</p>
<ul>
<li><strong>Ladyzhenskaya-Babuška-Brezzi (LBB)条件</strong>：保证压力-速度耦合的稳定性</li>
<li><strong>CFL条件</strong>：$\text{CFL} = \frac{u \Delta t}{\Delta x} \leq C_{\max}$，保证时间积分稳定性</li>
</ul>
<h2 id="122-simple">12.2 有限体积法与SIMPLE算法</h2>
<h3 id="1221">12.2.1 控制体积离散化</h3>
<p>有限体积法（FVM）是CFD中最常用的离散化方法，特别适合守恒问题。其核心思想是将计算域划分为有限个控制体积，在每个控制体积上积分守恒方程。</p>
<p>对于一般的守恒方程：
$$\frac{\partial \phi}{\partial t} + \nabla \cdot (\mathbf{u}\phi) = \nabla \cdot (\Gamma \nabla \phi) + S$$
在控制体积 $V$ 上积分：
$$\int_V \frac{\partial \phi}{\partial t} dV + \int_V \nabla \cdot (\mathbf{u}\phi) dV = \int_V \nabla \cdot (\Gamma \nabla \phi) dV + \int_V S dV$$
应用Gauss散度定理：
$$\frac{\partial}{\partial t} \int_V \phi dV + \oint_{\partial V} (\mathbf{u}\phi) \cdot \mathbf{n} dA = \oint_{\partial V} (\Gamma \nabla \phi) \cdot \mathbf{n} dA + \int_V S dV$$
对于结构化网格，控制体积 $P$ 的离散形式：
$$\frac{\phi_P^{n+1} - \phi_P^n}{\Delta t} V_P + \sum_f F_f = \sum_f D_f + S_P V_P$$
其中 $F_f$ 是对流通量，$D_f$ 是扩散通量，下标 $f$ 表示控制体积的各个面。</p>
<h3 id="1222">12.2.2 通量计算与守恒性</h3>
<p><strong>对流通量</strong>的计算需要界面值重构。常用格式：</p>
<ol>
<li>
<p><strong>中心差分</strong>（二阶精度，可能振荡）：
$$\phi_f = \frac{\phi_P + \phi_N}{2}$$</p>
</li>
<li>
<p><strong>迎风格式</strong>（一阶精度，数值耗散大）：
$$\phi_f = \begin{cases}
\phi_P &amp; \text{if } \mathbf{u}_f \cdot \mathbf{n}_f &gt; 0 \\
\phi_N &amp; \text{if } \mathbf{u}_f \cdot \mathbf{n}_f &lt; 0
\end{cases}$$</p>
</li>
<li>
<p><strong>QUICK格式</strong>（三阶精度）：
$$\phi_f = \phi_D + \frac{1}{8}[(3\phi_P - 2\phi_U - \phi_D) - (3\phi_N - 2\phi_D - \phi_{DD})]$$</p>
</li>
<li>
<p><strong>TVD格式</strong>（保单调性）：
$$\phi_f = \phi_P + \frac{1}{2}\psi(r)(\phi_P - \phi_U)$$
其中 $\psi(r)$ 是限制器函数，$r = (\phi_P - \phi_U)/(\phi_N - \phi_P)$ 是梯度比。</p>
</li>
</ol>
<p><strong>扩散通量</strong>使用中心差分：
$$D_f = \Gamma_f \frac{\phi_N - \phi_P}{\delta x_{PN}} A_f$$
<strong>守恒性</strong>是FVM的关键优势。对于内部面，从单元 $P$ 流出的通量等于流入相邻单元 $N$ 的通量：
$$F_{P \to N} + F_{N \to P} = 0$$
这保证了全局守恒性：
$$\sum_{\text{all cells}} \left(\frac{\partial \phi}{\partial t} V\right) = \sum_{\text{boundary faces}} F_{\text{boundary}}$$</p>
<h3 id="1223-">12.2.3 压力-速度耦合问题</h3>
<p>不可压缩流的主要挑战是压力-速度耦合。动量方程提供速度演化，但压力没有独立的演化方程。连续性方程 $\nabla \cdot \mathbf{u} = 0$ 实际上是压力的约束条件。</p>
<p>离散动量方程（以 $x$ 方向为例）：
$$a_P u_P = \sum_{nb} a_{nb} u_{nb} + (p_W - p_E)A_x + S_u$$
问题在于：</p>
<ol>
<li>压力梯度项中的压力未知</li>
<li>如果使用错误的压力场，得到的速度场不满足连续性</li>
<li>直接求解耦合系统计算量巨大</li>
</ol>
<p><strong>交错网格</strong>（Staggered Grid）是解决压力振荡的经典方法：</p>
<ul>
<li>压力 $p$ 存储在单元中心</li>
<li>速度分量 $u, v, w$ 存储在对应的面中心</li>
<li>避免了压力的棋盘格振荡</li>
</ul>
<h3 id="1224-simple">12.2.4 SIMPLE算法推导</h3>
<p>SIMPLE（Semi-Implicit Method for Pressure-Linked Equations）算法通过压力修正迭代求解耦合问题。</p>
<p><strong>算法步骤</strong>：</p>
<ol>
<li>
<p><strong>预测步</strong>：使用猜测压力场 $p^*$ 求解动量方程，得到预测速度 $\mathbf{u}^*$：
$$a_P u_P^* = \sum_{nb} a_{nb} u_{nb}^* + (p_W^* - p_E^*)A_x + S_u$$</p>
</li>
<li>
<p><strong>修正步</strong>：定义修正量：
$$p' = p - p^*, \quad u' = u - u^*, \quad v' = v - v^*$$</p>
</li>
<li>
<p><strong>修正关系</strong>：忽略邻居速度修正的影响（SIMPLE近似）：
$$u_P' = d_P(p_P' - p_E')$$
其中 $d_P = A_x/a_P$ 是压力-速度耦合系数。</p>
</li>
<li>
<p><strong>压力修正方程</strong>：将修正后的速度代入连续性方程：
$$\nabla \cdot \mathbf{u} = \nabla \cdot (\mathbf{u}^* + \mathbf{u}') = 0$$
得到压力修正的Poisson方程：
$$a_P p_P' = a_E p_E' + a_W p_W' + a_N p_N' + a_S p_S' + b$$
其中 $b = -(\rho u^* A)_e + (\rho u^* A)_w - (\rho v^* A)_n + (\rho v^* A)_s$。</p>
</li>
<li>
<p><strong>更新</strong>：
$$p^{n+1} = p^* + \alpha_p p'$$
$$\mathbf{u}^{n+1} = \mathbf{u}^* + \mathbf{u}'$$
其中 $\alpha_p \in (0.5, 0.8)$ 是欠松弛因子。</p>
</li>
</ol>
<h3 id="1225-simplecpiso">12.2.5 SIMPLEC、PISO变种</h3>
<p><strong>SIMPLEC</strong>（SIMPLE-Consistent）改进了速度修正近似：
$$u_P' = d_P(p_P' - p_E') + \sum_{nb} \frac{a_{nb}}{a_P - \sum a_{nb}} u_{nb}'$$
这提供了更一致的压力-速度关系，通常收敛更快。</p>
<p><strong>PISO</strong>（Pressure-Implicit with Splitting of Operators）执行多次压力修正：</p>
<ol>
<li>预测步（同SIMPLE）</li>
<li>第一次压力修正（同SIMPLE）</li>
<li>第二次压力修正：
$$a_P p_P'' = a_E p_E'' + a_W p_W'' + a_N p_N'' + a_S p_S'' + b''$$
其中 $b''$ 包含了第一次修正中忽略的邻居速度影响。</li>
</ol>
<p><strong>算法比较</strong>：</p>
<ul>
<li>SIMPLE：稳健但收敛慢，适合稳态问题</li>
<li>SIMPLEC：收敛快，但对初值敏感</li>
<li>PISO：适合瞬态问题，每个时间步收敛快</li>
</ul>
<p>在3D打印仿真中的应用：</p>
<ul>
<li>FDM挤出（低Re）：SIMPLE通常足够</li>
<li>金属熔池（中高Re）：PISO更适合捕捉瞬态现象</li>
<li>多相流：需要特殊处理界面处的压力跳跃</li>
</ul>
<h2 id="123-vof">12.3 VOF方法与自由表面追踪</h2>
<h3 id="1231-vs">12.3.1 界面捕获vs界面追踪</h3>
<p>在3D打印的多相流仿真中，准确追踪材料界面（如熔融材料与空气的界面）至关重要。主要有两类方法：</p>
<p><strong>界面追踪方法</strong>（Interface Tracking）：</p>
<ul>
<li>显式追踪界面位置</li>
<li>例如：移动网格法、前沿追踪法（Front-Tracking）</li>
<li>优点：界面清晰，精度高</li>
<li>缺点：拓扑变化复杂（合并、分裂）</li>
</ul>
<p><strong>界面捕获方法</strong>（Interface Capturing）：</p>
<ul>
<li>通过标量场隐式表示界面</li>
<li>例如：VOF、Level-Set、Phase-Field</li>
<li>优点：自然处理拓扑变化</li>
<li>缺点：界面可能扩散</li>
</ul>
<p><strong>方法比较</strong>：
| 方法 | 质量守恒 | 界面锐利度 | 曲率计算 | 拓扑变化 |</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>质量守恒</th>
<th>界面锐利度</th>
<th>曲率计算</th>
<th>拓扑变化</th>
</tr>
</thead>
<tbody>
<tr>
<td>VOF</td>
<td>优秀</td>
<td>良好</td>
<td>困难</td>
<td>自然</td>
</tr>
<tr>
<td>Level-Set</td>
<td>较差</td>
<td>优秀</td>
<td>容易</td>
<td>自然</td>
</tr>
<tr>
<td>CLSVOF</td>
<td>优秀</td>
<td>优秀</td>
<td>良好</td>
<td>自然</td>
</tr>
<tr>
<td>Front-Tracking</td>
<td>优秀</td>
<td>完美</td>
<td>容易</td>
<td>复杂</td>
</tr>
</tbody>
</table>
<h3 id="1232-vof">12.3.2 VOF输运方程</h3>
<p>VOF（Volume of Fluid）方法使用体积分数 $\alpha$ 表示每个单元中液相的体积比例：
$$\alpha = \begin{cases}
1 &amp; \text{完全液体} \\
0 &amp; \text{完全气体} \\
0 &lt; \alpha &lt; 1 &amp; \text{界面单元}
\end{cases}$$
VOF输运方程：
$$\frac{\partial \alpha}{\partial t} + \nabla \cdot (\alpha \mathbf{u}) = 0$$
对于不可压缩流（$\nabla \cdot \mathbf{u} = 0$），可重写为：
$$\frac{\partial \alpha}{\partial t} + \mathbf{u} \cdot \nabla \alpha = 0$$
<strong>物理性质插值</strong>：
$$\rho = \alpha \rho_l + (1-\alpha) \rho_g$$
$$\mu = \alpha \mu_l + (1-\alpha) \mu_g$$
<strong>数值挑战</strong>：</p>
<ol>
<li>界面扩散：数值耗散导致界面模糊</li>
<li>界面压缩：需要特殊处理保持界面锐利</li>
<li>守恒性：确保 $0 \leq \alpha \leq 1$</li>
</ol>
<p><strong>界面压缩技术</strong>：
添加人工压缩项：
$$\frac{\partial \alpha}{\partial t} + \nabla \cdot (\alpha \mathbf{u}) + \nabla \cdot (\alpha(1-\alpha) \mathbf{u}_r) = 0$$
其中 $\mathbf{u}_r$ 是相对速度，指向界面法向：
$$\mathbf{u}_r = C_\alpha |\mathbf{u}| \frac{\nabla \alpha}{|\nabla \alpha|}$$
$C_\alpha \in [0, 2]$ 是压缩系数。</p>
<h3 id="1233">12.3.3 界面重构算法</h3>
<p>从体积分数场重构界面是VOF的关键步骤。主要方法：</p>
<p><strong>SLIC</strong>（Simple Line Interface Calculation）：</p>
<ul>
<li>界面平行于坐标轴</li>
<li>简单但精度低</li>
</ul>
<p><strong>PLIC</strong>（Piecewise Linear Interface Calculation）：</p>
<ul>
<li>界面为平面段</li>
<li>需要确定界面法向和位置</li>
</ul>
<p><strong>界面法向计算</strong>：</p>
<ol>
<li>
<p><strong>Youngs方法</strong>（最常用）：
$$\mathbf{n} = -\frac{\nabla \alpha}{|\nabla \alpha|}$$
使用有限差分计算梯度：
$$n_x = \frac{1}{2\Delta x}[\alpha_{i+1,j,k} - \alpha_{i-1,j,k}]$$</p>
</li>
<li>
<p><strong>ELVIRA方法</strong>：
最小化界面重构误差，选择最佳法向。</p>
</li>
<li>
<p><strong>混合梯度法</strong>：
结合中心差分和单侧差分。</p>
</li>
</ol>
<p><strong>平面位置确定</strong>：
给定法向 $\mathbf{n}$ 和体积分数 $\alpha$，确定平面常数 $d$：
$$\mathbf{n} \cdot \mathbf{x} = d$$
使得切割体积等于 $\alpha V_{\text{cell}}$。这需要求解非线性方程，通常用Newton-Raphson法。</p>
<p><strong>几何计算</strong>：
对于立方体单元，平面切割产生的体积：
$$V(\alpha) = \begin{cases}
\frac{\alpha^3}{6n_x n_y n_z} &amp; \text{if } \alpha &lt; \alpha_1 \\
\alpha - \frac{(1-\alpha)^3}{6n_x n_y n_z} &amp; \text{if } \alpha &gt; 1 - \alpha_1
\end{cases}$$</p>
<h3 id="1234">12.3.4 表面张力建模</h3>
<p>表面张力在3D打印的液滴形成中起关键作用。VOF中常用CSF（Continuum Surface Force）模型。</p>
<p><strong>表面张力作为体积力</strong>：
$$\mathbf{F}_{\sigma} = \sigma \kappa \nabla \alpha$$
其中 $\sigma$ 是表面张力系数，$\kappa$ 是界面曲率。</p>
<p><strong>曲率计算</strong>（数值挑战）：
$$\kappa = -\nabla \cdot \mathbf{n} = -\nabla \cdot \left(\frac{\nabla \alpha}{|\nabla \alpha|}\right)$$
需要二阶导数，数值噪声大。改进方法：</p>
<ol>
<li>
<p><strong>光滑核函数法</strong>：
$$\tilde{\alpha} = \frac{\sum_j K(|\mathbf{x}_i - \mathbf{x}_j|) \alpha_j V_j}{\sum_j K(|\mathbf{x}_i - \mathbf{x}_j|) V_j}$$</p>
</li>
<li>
<p><strong>高度函数法</strong>（Height Function）：
局部拟合界面为 $z = h(x,y)$，曲率：
$$\kappa = \frac{h_{xx}(1 + h_y^2) - 2h_x h_y h_{xy} + h_{yy}(1 + h_x^2)}{(1 + h_x^2 + h_y^2)^{3/2}}$$
<strong>毛细数与Weber数</strong>：</p>
</li>
</ol>
<ul>
<li>毛细数：$Ca = \frac{\mu U}{\sigma}$（粘性力/表面张力）</li>
<li>Weber数：$We = \frac{\rho U^2 L}{\sigma}$（惯性力/表面张力）</li>
</ul>
<p>在3D打印喷墨中，液滴破碎条件：$We &gt; We_{\text{crit}} \approx 12$。</p>
<h3 id="1235-plic">12.3.5 PLIC与高阶格式</h3>
<p><strong>高阶VOF格式</strong>：</p>
<ol>
<li>
<p><strong>CICSAM</strong>（Compressive Interface Capturing Scheme for Arbitrary Meshes）：
自适应混合上风和下风格式：
$$\alpha_f = \begin{cases}
\min(1, \alpha_D/c_D) &amp; \text{if } 0 \leq \alpha_D \leq 1 \\
\alpha_D &amp; \text{otherwise}
\end{cases}$$</p>
</li>
<li>
<p><strong>HRIC</strong>（High Resolution Interface Capturing）：
$$\alpha_f = \begin{cases}
2\alpha_D &amp; \text{if } 0 \leq \alpha_D \leq 0.5 \\
1 &amp; \text{if } 0.5 &lt; \alpha_D \leq 1
\end{cases}$$</p>
</li>
<li>
<p><strong>isoAdvector</strong>：
几何VOF方法，精确积分通量：
$$F = \int_0^{\Delta t} \int_{A_f} \alpha(\mathbf{x}, t) \mathbf{u} \cdot \mathbf{n} \, dA \, dt$$
<strong>多维耦合</strong>：
避免维度分裂误差，使用无分裂算法：
$$\alpha^{n+1} = \alpha^n - \frac{\Delta t}{V} \sum_f (\alpha \mathbf{u} \cdot \mathbf{n} A)_f$$
<strong>保界性处理</strong>：
确保 $\alpha \in [0,1]$：</p>
</li>
<li>
<p>代数修正：$\alpha = \max(0, \min(1, \alpha))$</p>
</li>
<li>通量限制：调整通量保证物理界限</li>
<li>FCT（Flux-Corrected Transport）技术</li>
</ol>
<h2 id="124-boltzmann">12.4 格子Boltzmann方法</h2>
<h3 id="1241-boltzmannlbm">12.4.1 从Boltzmann方程到LBM</h3>
<p>格子Boltzmann方法（LBM）从介观尺度出发，通过粒子分布函数演化来模拟流体运动。这种方法在3D打印的多孔介质流动和复杂几何中特别有效。</p>
<p><strong>Boltzmann方程</strong>：
$$\frac{\partial f}{\partial t} + \boldsymbol{\xi} \cdot \nabla f + \mathbf{F} \cdot \nabla_{\boldsymbol{\xi}} f = \Omega(f)$$
其中 $f(\mathbf{x}, \boldsymbol{\xi}, t)$ 是速度分布函数，$\boldsymbol{\xi}$ 是粒子速度，$\Omega$ 是碰撞算子。</p>
<p><strong>BGK近似</strong>（Bhatnagar-Gross-Krook）：
$$\Omega(f) = -\frac{1}{\tau}(f - f^{eq})$$
其中 $\tau$ 是松弛时间，$f^{eq}$ 是平衡分布函数。</p>
<p><strong>离散速度模型</strong>：
将连续速度空间离散为有限个方向 $\{\mathbf{e}_i\}$：
$$f_i(\mathbf{x}, t) = f(\mathbf{x}, \mathbf{e}_i, t)$$
常用的D2Q9（2D，9个速度）和D3Q19（3D，19个速度）模型。</p>
<p><strong>D3Q19速度集</strong>：
$$\mathbf{e}_i = c \times \begin{cases}
(0,0,0) &amp; i=0 \\
(\pm1,0,0), (0,\pm1,0), (0,0,\pm1) &amp; i=1-6 \\
(\pm1,\pm1,0), (\pm1,0,\pm1), (0,\pm1,\pm1) &amp; i=7-18
\end{cases}$$
<strong>平衡分布函数</strong>（Maxwell-Boltzmann分布的Taylor展开）：
$$f_i^{eq} = w_i \rho \left[1 + \frac{\mathbf{e}_i \cdot \mathbf{u}}{c_s^2} + \frac{(\mathbf{e}_i \cdot \mathbf{u})^2}{2c_s^4} - \frac{\mathbf{u} \cdot \mathbf{u}}{2c_s^2}\right]$$
其中权重 $w_i$ 和声速 $c_s = c/\sqrt{3}$。</p>
<h3 id="1242">12.4.2 碰撞与流动步骤</h3>
<p>LBM算法分为两步：碰撞（局部）和流动（非局部）。</p>
<p><strong>碰撞步</strong>（Collision）：
$$f_i^*(\mathbf{x}, t) = f_i(\mathbf{x}, t) - \frac{\Delta t}{\tau}[f_i(\mathbf{x}, t) - f_i^{eq}(\mathbf{x}, t)]$$
<strong>流动步</strong>（Streaming）：
$$f_i(\mathbf{x} + \mathbf{e}_i \Delta t, t + \Delta t) = f_i^*(\mathbf{x}, t)$$</p>
<p><strong>宏观量计算</strong>：
密度：$$\rho = \sum_i f_i$$
动量：$$\rho \mathbf{u} = \sum_i f_i \mathbf{e}_i$$
压力：$$p = c_s^2 \rho$$
<strong>粘性系数与松弛时间的关系</strong>：
$$\nu = c_s^2 \left(\tau - \frac{\Delta t}{2}\right)$$
<strong>稳定性条件</strong>：
$$\tau &gt; 0.5 \Delta t$$
当 $\tau$ 接近 $0.5\Delta t$ 时，数值不稳定。实际中常取 $\tau \in [0.6, 2.0]\Delta t$。</p>
<p><strong>MRT（Multiple-Relaxation-Time）改进</strong>：
使用多个松弛时间提高稳定性：
$$\mathbf{f}^* = \mathbf{f} - \mathbf{M}^{-1} \mathbf{S} (\mathbf{m} - \mathbf{m}^{eq})$$
其中 $\mathbf{M}$ 是矩变换矩阵，$\mathbf{S}$ 是松弛参数对角矩阵。</p>
<h3 id="1243-chapman-enskog">12.4.3 Chapman-Enskog展开</h3>
<p>通过多尺度分析证明LBM收敛到Navier-Stokes方程。</p>
<p><strong>时空尺度分离</strong>：
$$\partial_t = \epsilon \partial_{t_1} + \epsilon^2 \partial_{t_2}$$
$$\nabla = \epsilon \nabla_1$$
<strong>分布函数展开</strong>：
$$f_i = f_i^{(0)} + \epsilon f_i^{(1)} + \epsilon^2 f_i^{(2)} + \mathcal{O}(\epsilon^3)$$
其中 $f_i^{(0)} = f_i^{eq}$。</p>
<p><strong>零阶（Euler方程）</strong>：
$$\partial_{t_0} \rho + \nabla_1 \cdot (\rho \mathbf{u}) = 0$$
$$\partial_{t_0} (\rho \mathbf{u}) + \nabla_1 \cdot \Pi^{(0)} = 0$$
<strong>一阶（Navier-Stokes方程）</strong>：
$$\partial_{t_1} \rho + \partial_{t_0} \rho + \nabla_1 \cdot (\rho \mathbf{u}) = 0$$
$$\partial_{t_1} (\rho \mathbf{u}) + \nabla_1 \cdot \Pi^{(1)} = 0$$
其中粘性应力张量：
$$\Pi^{(1)}_{αβ} = -\rho \nu \left(\partial_α u_β + \partial_β u_α - \frac{2}{3}\delta_{αβ} \nabla \cdot \mathbf{u}\right)$$</p>
<h3 id="1244">12.4.4 边界条件处理</h3>
<p>LBM的边界条件通过未知分布函数的重构实现。</p>
<p><strong>反弹边界</strong>（Bounce-Back，无滑移壁面）：
$$f_{\bar{i}}(\mathbf{x}_w, t+\Delta t) = f_i^*(\mathbf{x}_w, t)$$
其中 $\bar{i}$ 表示相反方向：$\mathbf{e}_{\bar{i}} = -\mathbf{e}_i$。</p>
<p><strong>Zou-He边界条件</strong>（速度/压力边界）：
对于已知速度 $\mathbf{u}_w$ 的边界：</p>
<ol>
<li>计算密度：$\rho = \frac{1}{1-u_n}[f_0 + f_{i_{\parallel}} + 2f_{i_{in}}]$</li>
<li>计算未知分布函数：
$$f_{i_{out}} = f_{i_{in}} + \frac{2\rho w_i u_n}{c_s^2}$$
<strong>滑移边界</strong>（Slip Boundary）：
镜面反射条件：
$$f_i(\mathbf{x}_w) = f_j(\mathbf{x}_w)$$
其中 $\mathbf{e}_j$ 是 $\mathbf{e}_i$ 关于壁面法向的镜像。</li>
</ol>
<p><strong>曲边界处理</strong>：</p>
<ol>
<li>
<p><strong>插值反弹法</strong>：
$$f_{\bar{i}}(\mathbf{x}_f) = (1-2\delta)f_i^*(\mathbf{x}_f) + 2\delta f_{\bar{i}}^*(\mathbf{x}_f) + 2w_i \rho \frac{\mathbf{e}_i \cdot \mathbf{u}_w}{c_s^2}$$
其中 $\delta$ 是流体节点到壁面的相对距离。</p>
</li>
<li>
<p><strong>浸没边界法</strong>（IBM）：
添加体积力实现无滑移条件。</p>
</li>
</ol>
<h3 id="1245-lbm">12.4.5 多相流LBM模型</h3>
<p>LBM特别适合处理复杂的多相流问题，在3D打印材料混合和界面演化中应用广泛。</p>
<p><strong>颜色模型</strong>（Color-Gradient Model）：
使用两套分布函数 $f_i^R$（红）和 $f_i^B$（蓝）表示两相：
$$f_i = f_i^R + f_i^B$$
相界面通过颜色梯度识别：
$$\mathbf{n} = \frac{\nabla \rho_N}{|\nabla \rho_N|}$$
其中 $\rho_N = (\rho^R - \rho^B)/(\rho^R + \rho^B)$。</p>
<p><strong>伪势模型</strong>（Shan-Chen Model）：
通过粒子间相互作用力模拟相分离：
$$\mathbf{F}(\mathbf{x}) = -\psi(\mathbf{x}) \sum_i w_i G \psi(\mathbf{x} + \mathbf{e}_i) \mathbf{e}_i$$
其中 $\psi$ 是伪势函数，$G$ 控制相互作用强度。</p>
<p>状态方程：
$$p = c_s^2 \rho + \frac{G c_s^2}{2} \psi^2$$
<strong>自由能模型</strong>（Free-Energy Model）：
基于热力学自由能泛函：
$$F = \int \left[\frac{\kappa}{2}|\nabla \phi|^2 + f(\phi)\right] d\mathbf{x}$$
化学势：
$$\mu = \frac{\delta F}{\delta \phi} = f'(\phi) - \kappa \nabla^2 \phi$$
<strong>多组分流动</strong>：
使用多个分布函数 $f_i^{\sigma}$ 表示不同组分，每个组分满足：
$$f_i^{\sigma}(\mathbf{x}+\mathbf{e}_i\Delta t, t+\Delta t) = f_i^{\sigma}(\mathbf{x},t) + \Omega_i^{\sigma} + \frac{\mathbf{F}^{\sigma} \cdot \mathbf{e}_i}{c_s^2} w_i \Delta t$$</p>
<h2 id="125-sph3d">12.5 SPH方法在3D打印中的应用</h2>
<h3 id="1251">12.5.1 核函数与粒子近似</h3>
<p>光滑粒子流体动力学（SPH）是一种无网格拉格朗日方法，特别适合模拟3D打印中的大变形、自由表面和材料喷射过程。</p>
<p><strong>核函数近似</strong>：
任意场变量 $A(\mathbf{x})$ 的SPH近似：
$$\langle A(\mathbf{x}) \rangle = \int A(\mathbf{x}') W(\mathbf{x} - \mathbf{x}', h) d\mathbf{x}'$$
其中 $W$ 是核函数，$h$ 是光滑长度。</p>
<p><strong>粒子离散</strong>：
$$A_i = \sum_j m_j \frac{A_j}{\rho_j} W_{ij}$$
其中 $W_{ij} = W(\mathbf{x}_i - \mathbf{x}_j, h)$，$m_j$ 是粒子质量。</p>
<p><strong>常用核函数</strong>：</p>
<ol>
<li>
<p><strong>Cubic Spline核</strong>（最常用）：
$$W(r,h) = \frac{1}{\pi h^3} \begin{cases}
1 - \frac{3}{2}q^2 + \frac{3}{4}q^3 &amp; 0 \leq q &lt; 1 \\
\frac{1}{4}(2-q)^3 &amp; 1 \leq q &lt; 2 \\
0 &amp; q \geq 2
\end{cases}$$
其中 $q = r/h$。</p>
</li>
<li>
<p><strong>Wendland核</strong>（紧支撑，光滑）：
$$W(r,h) = \frac{21}{16\pi h^3}(1-q)^4(1+4q), \quad 0 \leq q \leq 1$$</p>
</li>
<li>
<p><strong>Gaussian核</strong>（理论性好，计算量大）：
$$W(r,h) = \frac{1}{(\pi h^2)^{3/2}} \exp(-q^2)$$
<strong>梯度近似</strong>：
$$\nabla A_i = \sum_j m_j \frac{A_j - A_i}{\rho_j} \nabla_i W_{ij}$$
或反对称形式（动量守恒）：
$$\nabla A_i = \rho_i \sum_j m_j \left(\frac{A_j}{\rho_j^2} + \frac{A_i}{\rho_i^2}\right) \nabla_i W_{ij}$$</p>
</li>
</ol>
<h3 id="1252-sph">12.5.2 动量方程的SPH离散</h3>
<p><strong>连续性方程</strong>：
$$\frac{D\rho_i}{Dt} = \sum_j m_j (\mathbf{v}_i - \mathbf{v}_j) \cdot \nabla_i W_{ij}$$
<strong>动量方程</strong>（对称形式，保证动量守恒）：
$$\frac{D\mathbf{v}_i}{Dt} = -\sum_j m_j \left(\frac{p_i}{\rho_i^2} + \frac{p_j}{\rho_j^2} + \Pi_{ij}\right) \nabla_i W_{ij} + \mathbf{g}$$
其中 $\Pi_{ij}$ 是人工粘性项。</p>
<p><strong>压力计算</strong>：</p>
<ol>
<li>
<p><strong>弱可压缩SPH</strong>（WCSPH）：
使用状态方程：
$$p = B\left[\left(\frac{\rho}{\rho_0}\right)^{\gamma} - 1\right]$$
其中 $B = \rho_0 c_0^2/\gamma$，$c_0$ 是声速，$\gamma = 7$（水）。</p>
</li>
<li>
<p><strong>不可压缩SPH</strong>（ISPH）：
求解压力Poisson方程：
$$\nabla^2 p^{n+1} = \frac{\rho_0}{\Delta t^2} \nabla \cdot \mathbf{v}^*$$
<strong>粘性项</strong>：
物理粘性（层流）：
$$(\nabla \cdot \boldsymbol{\tau})_i = \sum_j m_j \frac{4\mu_0 r_{ij} \cdot \nabla_i W_{ij}}{\rho_i \rho_j (r_{ij}^2 + 0.01h^2)} (\mathbf{v}_i - \mathbf{v}_j)$$</p>
</li>
</ol>
<h3 id="1253">12.5.3 人工粘性与数值稳定性</h3>
<p><strong>Monaghan人工粘性</strong>：
$$\Pi_{ij} = \begin{cases}
\frac{-\alpha \bar{c}_{ij} \mu_{ij} + \beta \mu_{ij}^2}{\bar{\rho}_{ij}} &amp; \mathbf{v}_{ij} \cdot \mathbf{r}_{ij} &lt; 0 \\
0 &amp; \mathbf{v}_{ij} \cdot \mathbf{r}_{ij} \geq 0
\end{cases}$$
其中：
$$\mu_{ij} = \frac{h \mathbf{v}_{ij} \cdot \mathbf{r}_{ij}}{r_{ij}^2 + 0.01h^2}$$
$\alpha \approx 1$，$\beta \approx 2$，$\bar{c}_{ij} = (c_i + c_j)/2$。</p>
<p><strong>张力不稳定性</strong>（Tensile Instability）：
当粒子处于拉伸状态时的数值不稳定。解决方法：</p>
<ol>
<li>人工应力项</li>
<li>粒子位移修正（XSPH）：
$$\frac{d\mathbf{r}_i}{dt} = \mathbf{v}_i + \epsilon \sum_j \frac{m_j}{\bar{\rho}_{ij}} \mathbf{v}_{ij} W_{ij}$$
其中 $\epsilon \in [0.3, 0.5]$。</li>
</ol>
<p><strong>时间积分</strong>：</p>
<ol>
<li>
<p><strong>显式积分</strong>（Leap-Frog、Verlet）：
$$\mathbf{v}_i^{n+1/2} = \mathbf{v}_i^{n-1/2} + \Delta t \mathbf{a}_i^n$$
$$\mathbf{r}_i^{n+1} = \mathbf{r}_i^n + \Delta t \mathbf{v}_i^{n+1/2}$$</p>
</li>
<li>
<p><strong>时间步长限制</strong>：
$$\Delta t = \min(0.25 h/c, 0.125 h^2/\nu, 0.25\sqrt{h/|\mathbf{a}|_{\max}})$$</p>
</li>
</ol>
<h3 id="1254">12.5.4 边界处理与鬼粒子</h3>
<p><strong>固壁边界条件</strong>是SPH的主要挑战之一。</p>
<p><strong>排斥力方法</strong>（Lennard-Jones）：
$$\mathbf{F}_{wall} = D\left[\left(\frac{r_0}{r}\right)^{p_1} - \left(\frac{r_0}{r}\right)^{p_2}\right] \frac{\mathbf{r}}{r^2}$$
通常 $p_1 = 12$，$p_2 = 6$。</p>
<p><strong>鬼粒子方法</strong>（Ghost Particles）：</p>
<ol>
<li>在壁面外创建虚拟粒子</li>
<li>镜像流体粒子的物理量</li>
<li>施加边界条件：
   - 无滑移：$\mathbf{v}_{ghost} = 2\mathbf{v}_{wall} - \mathbf{v}_{fluid}$
   - 滑移：$\mathbf{v}_{ghost,\parallel} = \mathbf{v}_{fluid,\parallel}$</li>
</ol>
<p><strong>边界积分方法</strong>：
$$\langle A(\mathbf{x}) \rangle = \int_{\Omega} A(\mathbf{x}') W d\mathbf{x}' + \int_{\partial\Omega} A(\mathbf{x}') n \cdot \nabla W ds$$
<strong>统一半解析壁面边界</strong>（Unified Semi-Analytical Wall）：
结合解析积分和粒子贡献：
$$\rho_i = \sum_{j \in fluid} m_j W_{ij} + \rho_0 \int_{\Omega_{wall}} W(\mathbf{x}_i - \mathbf{x}') d\mathbf{x}'$$</p>
<h3 id="1255">12.5.5 熔融金属喷射仿真案例</h3>
<p>SPH在金属3D打印（如LENS、电子束熔融）的熔滴喷射仿真中应用广泛。</p>
<p><strong>物理模型</strong>：</p>
<ol>
<li>
<p><strong>热传导</strong>：
$$\rho c_p \frac{DT}{Dt} = \nabla \cdot (k \nabla T) + Q_{laser}$$
SPH离散：
$$\frac{DT_i}{Dt} = \sum_j \frac{4m_j k_i k_j}{(\rho_i \rho_j)(k_i + k_j)} \frac{T_{ij} \cdot r_{ij}}{r_{ij}^2 + 0.01h^2} \nabla_i W_{ij}$$</p>
</li>
<li>
<p><strong>相变模型</strong>（熔化/凝固）：
$$L_f \frac{Df_l}{Dt} = c_p \frac{DT}{Dt}$$
其中 $f_l$ 是液相分数，$L_f$ 是熔化潜热。</p>
</li>
<li>
<p><strong>表面张力</strong>（CSF模型）：
$$\mathbf{F}_{\sigma} = \sigma \kappa \delta_s \mathbf{n}$$
其中表面delta函数：
$$\delta_s = |\nabla c|$$
颜色函数 $c = 1$（液体），$c = 0$（气体）。</p>
</li>
</ol>
<p><strong>Marangoni效应</strong>（温度梯度引起的表面张力变化）：
$$\boldsymbol{\tau}_{Marangoni} = \frac{d\sigma}{dT} \nabla_s T$$
<strong>数值参数选择</strong>：</p>
<ul>
<li>粒子分辨率：$\Delta x \approx D_{droplet}/50$</li>
<li>光滑长度：$h = 1.2\Delta x$</li>
<li>时间步长：CFL = 0.2</li>
<li>人工粘性：$\alpha = 0.01$（低粘性金属）</li>
</ul>
<p><strong>典型仿真流程</strong>：</p>
<ol>
<li>初始化粒子位置和物理量</li>
<li>搜索邻居粒子（kd-tree、哈希表）</li>
<li>计算密度和压力</li>
<li>计算粘性力、表面张力、重力</li>
<li>更新速度和位置</li>
<li>计算热传导和相变</li>
<li>边界条件处理</li>
<li>输出可视化数据</li>
</ol>
<p><strong>验证指标</strong>：</p>
<ul>
<li>液滴速度：与Bernoulli方程对比</li>
<li>液滴尺寸：与Plateau-Rayleigh不稳定性理论对比</li>
<li>溅射角度：与实验测量对比</li>
</ul>
<h2 id="_1">本章小结</h2>
<p>本章系统介绍了计算流体动力学在3D打印中的应用，涵盖了从宏观连续介质到介观粒子方法的多尺度建模技术。</p>
<p><strong>核心概念回顾</strong>：</p>
<ol>
<li><strong>Navier-Stokes方程</strong>：不可压缩流体运动的基本方程，Reynolds数决定流动特性</li>
<li><strong>有限体积法</strong>：保证守恒性的离散化方法，SIMPLE算法解决压力-速度耦合</li>
<li><strong>VOF方法</strong>：体积分数追踪自由表面，适合处理拓扑变化</li>
<li><strong>格子Boltzmann方法</strong>：介观尺度方法，自然并行，处理复杂边界高效</li>
<li><strong>SPH方法</strong>：无网格拉格朗日方法，适合大变形和材料喷射</li>
</ol>
<p><strong>关键公式总结</strong>：</p>
<ul>
<li>不可压NS方程：$\rho(\partial_t \mathbf{u} + \mathbf{u} \cdot \nabla \mathbf{u}) = -\nabla p + \mu \nabla^2 \mathbf{u} + \rho \mathbf{g}$</li>
<li>Reynolds数：$Re = \rho UL/\mu$</li>
<li>VOF输运：$\partial_t \alpha + \nabla \cdot (\alpha \mathbf{u}) = 0$</li>
<li>LBM演化：$f_i(\mathbf{x}+\mathbf{e}_i\Delta t, t+\Delta t) = f_i(\mathbf{x},t) - \frac{\Delta t}{\tau}[f_i - f_i^{eq}]$</li>
<li>SPH近似：$A_i = \sum_j m_j (A_j/\rho_j) W_{ij}$</li>
</ul>
<p><strong>方法选择指南</strong>：
| 应用场景 | 推荐方法 | 理由 |</p>
<table>
<thead>
<tr>
<th>应用场景</th>
<th>推荐方法</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td>FDM挤出流动</td>
<td>FVM + SIMPLE</td>
<td>低Re数，稳态为主</td>
</tr>
<tr>
<td>液滴喷射</td>
<td>VOF/SPH</td>
<td>自由表面，表面张力重要</td>
</tr>
<tr>
<td>粉末床熔池</td>
<td>SPH/LBM</td>
<td>相变，Marangoni效应</td>
</tr>
<tr>
<td>多孔介质渗透</td>
<td>LBM</td>
<td>复杂几何，易于实现</td>
</tr>
<tr>
<td>材料混合</td>
<td>LBM多相流</td>
<td>自然处理相分离</td>
</tr>
</tbody>
</table>
<h2 id="_2">练习题</h2>
<h3 id="_3">基础题（理解概念）</h3>
<p><strong>题1</strong>：推导二维不可压缩Navier-Stokes方程的涡量-流函数形式。</p>
<details>
<summary>提示</summary>
<p>定义涡量 $\omega = \nabla \times \mathbf{u}$，流函数 $\psi$ 满足 $u = \partial_y \psi$，$v = -\partial_x \psi$。</p>
</details>
<details>
<summary>答案</summary>
<p>涡量输运方程：$\partial_t \omega + \mathbf{u} \cdot \nabla \omega = \nu \nabla^2 \omega$
流函数Poisson方程：$\nabla^2 \psi = -\omega$
这种形式自动满足连续性方程，消除了压力项。</p>
</details>
<p><strong>题2</strong>：对于特征长度 $L = 1$ mm，速度 $U = 0.1$ m/s 的熔融PLA（$\rho = 1200$ kg/m³，$\mu = 100$ Pa·s）挤出过程，计算Reynolds数并判断流动状态。</p>
<details>
<summary>答案</summary>
<p>$Re = \rho UL/\mu = 1200 \times 0.1 \times 0.001 / 100 = 0.0012 \ll 1$
这是典型的Stokes流（爬流），惯性项可忽略。</p>
</details>
<p><strong>题3</strong>：证明有限体积法的全局守恒性。</p>
<details>
<summary>提示</summary>
<p>考虑所有控制体积的通量总和，内部面的贡献相互抵消。</p>
</details>
<details>
<summary>答案</summary>
<p>对所有控制体积求和：
$\sum_{CV} \left[\frac{\partial}{\partial t}\int_{CV} \phi dV + \oint_{\partial CV} \mathbf{F} \cdot \mathbf{n} dA\right] = \sum_{CV} S_{CV}$
内部面：$F_{ij} + F_{ji} = 0$（通量守恒）
因此：$\frac{d}{dt}\int_{\Omega} \phi dV = -\oint_{\partial\Omega} \mathbf{F} \cdot \mathbf{n} dA + \int_{\Omega} S dV$</p>
</details>
<h3 id="_4">进阶题（深入理解）</h3>
<p><strong>题4</strong>：推导SIMPLE算法中压力修正方程的系数表达式。</p>
<details>
<summary>提示</summary>
<p>从离散动量方程出发，利用连续性约束推导压力Poisson方程。</p>
</details>
<details>
<summary>答案</summary>
<p>东面系数：$a_E = \rho_e d_e A_e = \rho_e (A_e^2/a_P^u) $
西面系数：$a_W = \rho_w d_w A_w$
中心系数：$a_P = a_E + a_W + a_N + a_S$
源项：$b = -[(\rho u^* A)_e - (\rho u^* A)_w + (\rho v^* A)_n - (\rho v^* A)_s]$</p>
</details>
<p><strong>题5</strong>：分析VOF方法中界面压缩参数 $C_\alpha$ 对界面锐利度的影响。设计数值实验验证。</p>
<details>
<summary>提示</summary>
<p>考虑一维对流问题，分析不同 $C_\alpha$ 值下的界面厚度演化。</p>
</details>
<details>
<summary>答案</summary>
<p>界面厚度 $\delta \propto 1/C_\alpha$。$C_\alpha = 0$：纯对流，界面扩散；$C_\alpha = 1$：适度压缩；$C_\alpha = 2$：过度压缩可能导致界面变形。
数值实验：Zalesak圆盘旋转测试，测量不同 $C_\alpha$ 下的界面厚度和形状误差。</p>
</details>
<h3 id="_5">挑战题（综合应用）</h3>
<p><strong>题6</strong>：设计一个混合CFD方法，结合VOF和LBM的优势，用于模拟3D打印中的多相流问题。讨论耦合策略和数据交换。</p>
<details>
<summary>提示</summary>
<p>考虑在界面附近使用VOF，远场使用LBM，设计合适的过渡区。</p>
</details>
<details>
<summary>答案</summary>
<p>耦合策略：</p>
<ol>
<li>域分解：界面区域（VOF）+ 单相区域（LBM）</li>
<li>数据映射：$f_i \leftrightarrow (\rho, \mathbf{u}, p)$通过Chapman-Enskog展开</li>
<li>时间步进：子循环或统一时间步</li>
<li>界面重构：VOF提供界面位置给LBM边界条件
优势：VOF的界面精度 + LBM的并行效率</li>
</ol>
</details>
<p><strong>题7</strong>：推导SPH方法中保证角动量守恒的粘性力公式。</p>
<details>
<summary>提示</summary>
<p>要求 $\mathbf{F}_{ij} = -\mathbf{F}_{ji}$ 且 $\mathbf{r}_{ij} \times \mathbf{F}_{ij} = 0$。</p>
</details>
<details>
<summary>答案</summary>
<p>Morris粘性公式：
$$\mathbf{F}_{ij}^{visc} = \frac{2\mu m_j}{\rho_i \rho_j} \frac{\mathbf{v}_{ij} \cdot \mathbf{r}_{ij}}{r_{ij}^2 + 0.01h^2} \nabla_i W_{ij}$$
验证：$\mathbf{F}_{ij} \parallel \nabla_i W_{ij} \parallel \mathbf{r}_{ij}$，因此 $\mathbf{r}_{ij} \times \mathbf{F}_{ij} = 0$</p>
</details>
<p><strong>题8</strong>（开放问题）：提出一种新的自适应网格细化策略for VOF方法，能够在保持界面精度的同时减少计算量。考虑3D打印液滴碰撞合并的场景。</p>
<details>
<summary>思考方向</summary>
<ol>
<li>基于界面曲率的细化准则</li>
<li>动态负载均衡</li>
<li>保守插值算子</li>
<li>时空自适应策略</li>
</ol>
</details>
<h2 id="_6">常见陷阱与错误</h2>
<h3 id="_7">数值稳定性问题</h3>
<ol>
<li>
<p><strong>CFL条件违反</strong>：时间步长过大导致数值爆炸
   - 解决：自适应时间步长，$\Delta t = C_{CFL} \min(\Delta x/u, \Delta x^2/\nu)$</p>
</li>
<li>
<p><strong>压力-速度解耦</strong>：交错网格配置错误导致棋盘格振荡
   - 解决：正确实现Rhie-Chow插值</p>
</li>
<li>
<p><strong>低Mach数问题</strong>：可压缩求解器在低速流动中的刚性问题
   - 解决：使用预条件技术或不可压缩求解器</p>
</li>
</ol>
<h3 id="_8">界面处理错误</h3>
<ol>
<li>
<p><strong>VOF界面扩散</strong>：数值耗散导致界面模糊
   - 解决：使用高阶PLIC重构，界面压缩技术</p>
</li>
<li>
<p><strong>曲率计算噪声</strong>：二阶导数放大数值误差
   - 解决：光滑核函数，高度函数法</p>
</li>
<li>
<p><strong>质量不守恒</strong>：界面重构误差累积
   - 解决：几何VOF方法，通量修正</p>
</li>
</ol>
<h3 id="lbm">LBM特有问题</h3>
<ol>
<li>
<p><strong>压缩性误差</strong>：$Ma = u/c_s$ 过大
   - 解决：降低特征速度或使用不可压缩LBM</p>
</li>
<li>
<p><strong>边界条件不一致</strong>：质量泄漏或动量不守恒
   - 解决：使用一致的边界格式，如Zou-He条件</p>
</li>
</ol>
<h3 id="sph">SPH数值问题</h3>
<ol>
<li>
<p><strong>张力不稳定性</strong>：粒子聚集或分离
   - 解决：人工应力，XSPH修正</p>
</li>
<li>
<p><strong>边界缺陷</strong>：近壁粒子缺乏邻居
   - 解决：鬼粒子或边界积分方法</p>
</li>
<li>
<p><strong>零能量模式</strong>：某些变形模式无阻尼
   - 解决：使用修正的梯度算子</p>
</li>
</ol>
<h2 id="_9">最佳实践检查清单</h2>
<h3 id="_10">前处理阶段</h3>
<ul>
<li>[ ] <strong>物理参数估算</strong></li>
<li>[ ] 计算Reynolds数、Weber数、Capillary数</li>
<li>[ ] 判断流动regime（层流/湍流、可压/不可压）</li>
<li>
<p>[ ] 确定主导物理过程</p>
</li>
<li>
<p>[ ] <strong>方法选择</strong></p>
</li>
<li>[ ] 根据Re数选择求解器（Stokes、NS、湍流模型）</li>
<li>[ ] 根据界面复杂度选择多相流方法</li>
<li>
<p>[ ] 考虑并行化需求</p>
</li>
<li>
<p>[ ] <strong>网格/粒子设计</strong></p>
</li>
<li>[ ] 界面分辨率 &gt; 10个网格/粒子</li>
<li>[ ] 边界层网格 $y^+ \approx 1$（壁面函数时 $y^+ \approx 30$）</li>
<li>[ ] 网格质量检查（正交性、长宽比）</li>
</ul>
<h3 id="_11">数值设置</h3>
<ul>
<li>[ ] <strong>时间步长</strong></li>
<li>[ ] CFL &lt; 0.5（显式格式）</li>
<li>[ ] 扩散数 $D = \nu \Delta t/\Delta x^2 &lt; 0.5$</li>
<li>
<p>[ ] 表面张力约束 $\Delta t &lt; \sqrt{\rho \Delta x^3/(2\pi\sigma)}$</p>
</li>
<li>
<p>[ ] <strong>离散格式</strong></p>
</li>
<li>[ ] 对流项：二阶迎风或TVD格式</li>
<li>[ ] 扩散项：中心差分</li>
<li>
<p>[ ] 时间积分：二阶精度以上</p>
</li>
<li>
<p>[ ] <strong>收敛准则</strong></p>
</li>
<li>[ ] 残差下降3-4个数量级</li>
<li>[ ] 关键物理量监测（质量守恒、能量守恒）</li>
<li>[ ] 网格收敛性研究</li>
</ul>
<h3 id="_12">后处理验证</h3>
<ul>
<li>[ ] <strong>守恒性检查</strong></li>
<li>[ ] 质量守恒误差 &lt; 0.1%</li>
<li>[ ] 动量守恒（特别是对称问题）</li>
<li>
<p>[ ] 能量守恒（如有）</p>
</li>
<li>
<p>[ ] <strong>物理合理性</strong></p>
</li>
<li>[ ] 压力场光滑无振荡</li>
<li>[ ] 速度场满足边界条件</li>
<li>
<p>[ ] 界面形状符合物理预期</p>
</li>
<li>
<p>[ ] <strong>与理论/实验对比</strong></p>
</li>
<li>[ ] 标准算例验证（cavity flow、droplet oscillation）</li>
<li>[ ] 实验数据对比</li>
<li>[ ] 理论解对比（如有）</li>
</ul>
<h3 id="_13">性能优化</h3>
<ul>
<li>[ ] <strong>并行效率</strong></li>
<li>[ ] 负载均衡（特别是自适应网格）</li>
<li>[ ] 通信优化（减少鬼单元层数）</li>
<li>
<p>[ ] I/O优化（并行输出）</p>
</li>
<li>
<p>[ ] <strong>内存管理</strong></p>
</li>
<li>[ ] 稀疏矩阵存储格式选择</li>
<li>[ ] 动态内存分配最小化</li>
<li>[ ] 缓存友好的数据结构</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="./chapter11.html" class="nav-link prev">← 第11章：误差分析与补偿</a><a href="./chapter13.html" class="nav-link next">第13章：多相流与传热 →</a></nav>
        </main>
    </div>
</body>
</html>