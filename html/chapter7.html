<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第7章：拓扑优化基础</title>
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="stylesheet" href="./assets/highlight.css">
    <script src="./assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <ul class="nav-list"><li class=""><a href="./index.html">3D打印中的数学原理与计算方法</a></li><li class=""><a href="./chapter1.html">第1章：几何表示与变换</a></li><li class=""><a href="./chapter2.html">第2章：微分几何与离散算子</a></li><li class=""><a href="./chapter3.html">第3章：计算共形几何</a></li><li class=""><a href="./chapter4.html">第4章：计算拓扑与同调</a></li><li class=""><a href="./chapter5.html">第5章：网格处理算法</a></li><li class=""><a href="./chapter6.html">第6章：有限元方法与结构分析</a></li><li class="active"><a href="./chapter7.html">第7章：拓扑优化基础</a></li><li class=""><a href="./chapter8.html">第8章：高级拓扑优化</a></li><li class=""><a href="./chapter9.html">第9章：切片算法与支撑生成</a></li><li class=""><a href="./chapter10.html">第10章：路径规划与填充</a></li><li class=""><a href="./chapter11.html">第11章：误差分析与补偿</a></li><li class=""><a href="./chapter12.html">第12章：流体仿真基础</a></li><li class=""><a href="./chapter13.html">第13章：多相流与传热</a></li><li class=""><a href="./chapter14.html">第14章：多视图几何</a></li><li class=""><a href="./chapter15.html">第15章：神经隐式表示</a></li><li class=""><a href="./chapter16.html">第16章：3D Gaussian Splatting</a></li><li class=""><a href="./chapter17.html">第17章：可微渲染基础</a></li><li class=""><a href="./chapter18.html">第18章：高级可微渲染与逆向问题</a></li><li class=""><a href="./chapter19.html">第19章：符号几何与程序化建模</a></li><li class=""><a href="./chapter20.html">第20章：神经程序合成</a></li><li class=""><a href="./chapter21.html">第21章：深度生成模型</a></li><li class=""><a href="./chapter22.html">第22章：形状分析与检索</a></li><li class=""><a href="./chapter23.html">第23章：多材料与4D打印</a></li><li class=""><a href="./chapter24.html">第24章：仿生设计与自然算法</a></li><li class=""><a href="./chapter25.html">第25章：逆向问题与参数估计</a></li><li class=""><a href="./chapter26.html">第26章：实时仿真与数字孪生</a></li><li class=""><a href="./chapter27.html">第27章：常用工具与库</a></li><li class=""><a href="./CLAUDE.html">Untitled</a></li></ul>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="7">第7章：拓扑优化基础</h1>
<p>拓扑优化是一种数学方法，用于在给定设计空间内寻找材料的最优分布，以满足特定的性能目标和约束条件。本章将深入探讨拓扑优化的核心数学原理，从经典的SIMP方法开始，逐步介绍敏感度分析、数值稳定性技术和实用优化算法。我们将重点关注连续体结构的拓扑优化，为后续的高级主题（水平集方法、多材料优化等）奠定基础。</p>
<h2 id="71-simp">7.1 SIMP方法与密度插值</h2>
<h3 id="711">7.1.1 拓扑优化的数学框架</h3>
<p>拓扑优化问题的一般形式可以表述为：</p>
<p>$$
\begin{aligned}
\min_{\boldsymbol{\rho}} \quad &amp; c(\boldsymbol{\rho}) = \mathbf{U}^T\mathbf{K}\mathbf{U} \\
\text{s.t.} \quad &amp; \mathbf{K}\mathbf{U} = \mathbf{F} \\
&amp; V(\boldsymbol{\rho}) = \int_\Omega \rho \, d\Omega \leq V_0 \\
&amp; 0 &lt; \rho_{\min} \leq \rho_e \leq 1, \quad e = 1, ..., N
\end{aligned}
$$</p>
<p>其中：</p>
<ul>
<li>$\boldsymbol{\rho} = [\rho_1, \rho_2, ..., \rho_N]^T$ 是设计变量（单元密度）</li>
<li>$c(\boldsymbol{\rho})$ 是目标函数（通常为柔度）</li>
<li>$\mathbf{K}$ 是全局刚度矩阵</li>
<li>$\mathbf{U}$ 是位移向量</li>
<li>$\mathbf{F}$ 是外力向量</li>
<li>$V_0$ 是体积约束</li>
</ul>
<h3 id="712-simp">7.1.2 SIMP插值模型</h3>
<p>SIMP (Solid Isotropic Material with Penalization) 方法通过幂律插值建立密度与材料属性的关系：</p>
<p>$$
E_e(\rho_e) = \rho_e^p E_0
$$</p>
<p>其中 $p$ 是惩罚因子（通常 $p = 3$），$E_0$ 是实体材料的弹性模量。</p>
<p>单元刚度矩阵的插值：
$$
\mathbf{k}_e(\rho_e) = \rho_e^p \mathbf{k}_e^0
$$</p>
<p>这种插值策略的关键在于惩罚中间密度值，推动优化结果趋向0-1分布。</p>
<h3 id="713">7.1.3 插值函数的数学性质</h3>
<p>为了保证优化问题的良定性，插值函数应满足：</p>
<ol>
<li><strong>单调性</strong>：$\frac{\partial E(\rho)}{\partial \rho} &gt; 0$</li>
<li><strong>凸性条件</strong>：对于柔度最小化，需要 $p \geq \max(2, 2/\nu)$，其中 $\nu$ 是泊松比</li>
<li><strong>Hashin-Shtrikman界限</strong>：插值函数应在理论界限内</li>
</ol>
<p>修正的SIMP模型（RAMP）：
$$
E(\rho) = E_0 \frac{\rho(1 + q)}{1 + q\rho}
$$</p>
<p>其中 $q$ 是惩罚参数（通常 $q = 8$）。</p>
<h3 id="714">7.1.4 离散化与有限元公式</h3>
<p>考虑2D平面应力问题，单元刚度矩阵：</p>
<p>$$
\mathbf{k}_e^0 = t \int_{\Omega_e} \mathbf{B}^T \mathbf{D}_0 \mathbf{B} \, d\Omega
$$</p>
<p>其中：</p>
<ul>
<li>$t$ 是厚度</li>
<li>$\mathbf{B}$ 是应变-位移矩阵</li>
<li>$\mathbf{D}_0$ 是材料本构矩阵</li>
</ul>
<p>对于双线性四边形单元，使用2×2高斯积分：
$$
\mathbf{k}_e^0 = t \sum_{i=1}^{4} w_i \mathbf{B}^T(\xi_i, \eta_i) \mathbf{D}_0 \mathbf{B}(\xi_i, \eta_i) |\mathbf{J}(\xi_i, \eta_i)|
$$</p>
<h4 id="-">应变-位移矩阵的构造</h4>
<p>对于四节点四边形单元，位移场插值：
$$
\mathbf{u}(x,y) = \sum_{i=1}^4 N_i(x,y) \mathbf{u}_i
$$</p>
<p>其中形函数在参数坐标系中：
$$
\begin{aligned}
N_1(\xi, \eta) &amp;= \frac{1}{4}(1-\xi)(1-\eta) \\
N_2(\xi, \eta) &amp;= \frac{1}{4}(1+\xi)(1-\eta) \\
N_3(\xi, \eta) &amp;= \frac{1}{4}(1+\xi)(1+\eta) \\
N_4(\xi, \eta) &amp;= \frac{1}{4}(1-\xi)(1+\eta)
\end{aligned}
$$</p>
<p>应变-位移关系：
$$
\boldsymbol{\varepsilon} = \begin{bmatrix} \varepsilon_{xx} \\ \varepsilon_{yy} \\ \gamma_{xy} \end{bmatrix} = \begin{bmatrix} \frac{\partial u}{\partial x} \\ \frac{\partial v}{\partial y} \\ \frac{\partial u}{\partial y} + \frac{\partial v}{\partial x} \end{bmatrix}
$$</p>
<p>通过链式法则，需要雅可比矩阵：
$$
\mathbf{J} = \begin{bmatrix} 
\frac{\partial x}{\partial \xi} &amp; \frac{\partial y}{\partial \xi} \\
\frac{\partial x}{\partial \eta} &amp; \frac{\partial y}{\partial \eta}
\end{bmatrix} = \sum_{i=1}^4 \begin{bmatrix}
\frac{\partial N_i}{\partial \xi} x_i &amp; \frac{\partial N_i}{\partial \xi} y_i \\
\frac{\partial N_i}{\partial \eta} x_i &amp; \frac{\partial N_i}{\partial \eta} y_i
\end{bmatrix}
$$</p>
<p>形函数对物理坐标的导数：
$$
\begin{bmatrix} 
\frac{\partial N_i}{\partial x} \\ 
\frac{\partial N_i}{\partial y} 
\end{bmatrix} = \mathbf{J}^{-1} \begin{bmatrix} 
\frac{\partial N_i}{\partial \xi} \\ 
\frac{\partial N_i}{\partial \eta} 
\end{bmatrix}
$$</p>
<p>最终应变-位移矩阵：
$$
\mathbf{B} = \begin{bmatrix}
\frac{\partial N_1}{\partial x} &amp; 0 &amp; \frac{\partial N_2}{\partial x} &amp; 0 &amp; \cdots \\
0 &amp; \frac{\partial N_1}{\partial y} &amp; 0 &amp; \frac{\partial N_2}{\partial y} &amp; \cdots \\
\frac{\partial N_1}{\partial y} &amp; \frac{\partial N_1}{\partial x} &amp; \frac{\partial N_2}{\partial y} &amp; \frac{\partial N_2}{\partial x} &amp; \cdots
\end{bmatrix}
$$</p>
<h4 id="_1">本构矩阵</h4>
<p>平面应力状态下的本构矩阵：
$$
\mathbf{D}_0 = \frac{E}{1-\nu^2} \begin{bmatrix}
1 &amp; \nu &amp; 0 \\
\nu &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; \frac{1-\nu}{2}
\end{bmatrix}
$$</p>
<p>平面应变状态：
$$
\mathbf{D}_0 = \frac{E}{(1+\nu)(1-2\nu)} \begin{bmatrix}
1-\nu &amp; \nu &amp; 0 \\
\nu &amp; 1-\nu &amp; 0 \\
0 &amp; 0 &amp; \frac{1-2\nu}{2}
\end{bmatrix}
$$</p>
<h4 id="_2">数值积分点选择</h4>
<p>高斯积分点位置和权重（2×2方案）：
$$
\xi_{1,2} = \pm \frac{1}{\sqrt{3}}, \quad \eta_{1,2} = \pm \frac{1}{\sqrt{3}}, \quad w_i = 1
$$</p>
<p>完全积分vs减缩积分：</p>
<ul>
<li><strong>完全积分</strong>（2×2）：精确积分双线性项，避免零能模式</li>
<li><strong>减缩积分</strong>（1×1）：降低计算成本，但可能引入沙漏模式</li>
<li><strong>选择性减缩积分</strong>：剪切项减缩，避免剪切锁定</li>
</ul>
<h3 id="715-simp">7.1.5 多材料SIMP扩展</h3>
<p>对于 $m$ 种材料的拓扑优化：
$$
E_e = \sum_{i=1}^m \rho_{e,i}^p E_i
$$</p>
<p>约束条件：
$$
\sum_{i=1}^m \rho_{e,i} = 1, \quad \rho_{e,i} \geq 0
$$</p>
<p>Zuo-Kang插值方案：
$$
E_e = \sum_{i=1}^m \rho_{e,i} E_i \left( \sum_{j=1}^m \rho_{e,j}^p \right)^{-1}
$$</p>
<h3 id="716-simp">7.1.6 各向异性材料的SIMP</h3>
<p>对于正交各向异性材料，弹性张量插值：
$$
\mathbf{C}_e(\rho_e, \theta_e) = \rho_e^p \mathbf{T}(\theta_e)^T \mathbf{C}_0 \mathbf{T}(\theta_e)
$$</p>
<p>其中 $\mathbf{T}(\theta_e)$ 是旋转变换矩阵，$\theta_e$ 是纤维方向角。</p>
<p>离散材料方向优化（DMO）：
$$
\mathbf{C}_e = \sum_{k=1}^{N_\theta} w_{e,k} \rho_e^p \mathbf{C}_0^{(k)}
$$</p>
<p>其中 $w_{e,k}$ 是方向权重，满足 $\sum_k w_{e,k} = 1$。</p>
<h2 id="72">7.2 敏感度分析与伴随方法</h2>
<h3 id="721">7.2.1 直接微分法</h3>
<p>目标函数对设计变量的敏感度：</p>
<p>$$
\frac{\partial c}{\partial \rho_e} = \frac{\partial c}{\partial \mathbf{U}} \frac{\partial \mathbf{U}}{\partial \rho_e} + \frac{\partial c}{\partial \mathbf{K}} \frac{\partial \mathbf{K}}{\partial \rho_e}
$$</p>
<p>从平衡方程 $\mathbf{K}\mathbf{U} = \mathbf{F}$ 微分：
$$
\frac{\partial \mathbf{K}}{\partial \rho_e} \mathbf{U} + \mathbf{K} \frac{\partial \mathbf{U}}{\partial \rho_e} = 0
$$</p>
<p>因此：
$$
\frac{\partial \mathbf{U}}{\partial \rho_e} = -\mathbf{K}^{-1} \frac{\partial \mathbf{K}}{\partial \rho_e} \mathbf{U}
$$</p>
<h3 id="722">7.2.2 伴随方法</h3>
<p>引入拉格朗日函数：
$$
\mathcal{L} = c(\mathbf{U}, \boldsymbol{\rho}) + \boldsymbol{\lambda}^T(\mathbf{K}\mathbf{U} - \mathbf{F})
$$</p>
<p>伴随方程：
$$
\mathbf{K}^T \boldsymbol{\lambda} = -\frac{\partial c}{\partial \mathbf{U}}
$$</p>
<p>对于柔度目标函数 $c = \mathbf{U}^T\mathbf{K}\mathbf{U}$：
$$
\boldsymbol{\lambda} = -2\mathbf{U}
$$</p>
<p>最终敏感度：
$$
\frac{\partial c}{\partial \rho_e} = -p\rho_e^{p-1} \mathbf{u}_e^T \mathbf{k}_e^0 \mathbf{u}_e
$$</p>
<h3 id="723">7.2.3 体积约束的敏感度</h3>
<p>体积约束函数：
$$
g(\boldsymbol{\rho}) = \sum_{e=1}^N \rho_e v_e - V_0
$$</p>
<p>敏感度：
$$
\frac{\partial g}{\partial \rho_e} = v_e
$$</p>
<p>其中 $v_e$ 是单元体积。</p>
<h3 id="724">7.2.4 应力约束的敏感度</h3>
<p>von Mises应力：
$$
\sigma_{vm} = \sqrt{\sigma^T \mathbf{M} \sigma}
$$</p>
<p>其中 $\mathbf{M}$ 是von Mises矩阵。</p>
<p>应力对密度的敏感度（考虑qp松弛）：
$$
\frac{\partial \sigma_{vm}}{\partial \rho_e} = \frac{1}{2\sigma_{vm}} \left( 2\sigma^T \mathbf{M} \frac{\partial \sigma}{\partial \rho_e} \right)
$$</p>
<p>其中：
$$
\frac{\partial \sigma}{\partial \rho_e} = p\rho_e^{p-1} \mathbf{D}_0 \mathbf{B} \mathbf{u}_e + \rho_e^p \mathbf{D}_0 \mathbf{B} \frac{\partial \mathbf{u}_e}{\partial \rho_e}
$$</p>
<h4 id="von-mises">von Mises矩阵的具体形式</h4>
<p>对于2D平面应力：
$$
\mathbf{M} = \begin{bmatrix}
1 &amp; -0.5 &amp; 0 \\
-0.5 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 3
\end{bmatrix}
$$</p>
<p>对于3D情况：
$$
\mathbf{M} = \begin{bmatrix}
1 &amp; -0.5 &amp; -0.5 &amp; 0 &amp; 0 &amp; 0 \\
-0.5 &amp; 1 &amp; -0.5 &amp; 0 &amp; 0 &amp; 0 \\
-0.5 &amp; -0.5 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 3 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 3 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 3
\end{bmatrix}
$$</p>
<h4 id="_3">主应力约束</h4>
<p>最大主应力：
$$
\sigma_1 = \frac{\sigma_{xx} + \sigma_{yy}}{2} + \sqrt{\left(\frac{\sigma_{xx} - \sigma_{yy}}{2}\right)^2 + \tau_{xy}^2}
$$</p>
<p>主应力敏感度：
$$
\frac{\partial \sigma_1}{\partial \rho_e} = \frac{\partial \sigma_1}{\partial \boldsymbol{\sigma}} \cdot \frac{\partial \boldsymbol{\sigma}}{\partial \rho_e}
$$</p>
<p>其中：
$$
\frac{\partial \sigma_1}{\partial \boldsymbol{\sigma}} = \begin{bmatrix}
\frac{1}{2} + \frac{\sigma_{xx} - \sigma_{yy}}{4\sqrt{(\sigma_{xx} - \sigma_{yy})^2/4 + \tau_{xy}^2}} \\
\frac{1}{2} - \frac{\sigma_{xx} - \sigma_{yy}}{4\sqrt{(\sigma_{xx} - \sigma_{yy})^2/4 + \tau_{xy}^2}} \\
\frac{\tau_{xy}}{\sqrt{(\sigma_{xx} - \sigma_{yy})^2/4 + \tau_{xy}^2}}
\end{bmatrix}
$$</p>
<h3 id="725">7.2.5 多载荷敏感度</h3>
<p>对于 $L$ 个载荷工况的加权目标：
$$
c = \sum_{l=1}^L w_l c_l = \sum_{l=1}^L w_l \mathbf{U}_l^T \mathbf{K} \mathbf{U}_l
$$</p>
<p>敏感度：
$$
\frac{\partial c}{\partial \rho_e} = -\sum_{l=1}^L w_l p\rho_e^{p-1} \mathbf{u}_{e,l}^T \mathbf{k}_e^0 \mathbf{u}_{e,l}
$$</p>
<h3 id="726">7.2.6 特征值问题的敏感度</h3>
<p>对于频率约束的拓扑优化，考虑广义特征值问题：
$$
\mathbf{K}\boldsymbol{\phi}_i = \lambda_i \mathbf{M}\boldsymbol{\phi}_i
$$</p>
<p>特征值敏感度（Nelson方法）：
$$
\frac{\partial \lambda_i}{\partial \rho_e} = \boldsymbol{\phi}_i^T \left( \frac{\partial \mathbf{K}}{\partial \rho_e} - \lambda_i \frac{\partial \mathbf{M}}{\partial \rho_e} \right) \boldsymbol{\phi}_i
$$</p>
<p>考虑质量归一化 $\boldsymbol{\phi}_i^T \mathbf{M} \boldsymbol{\phi}_i = 1$。</p>
<p>对于重复特征值的情况，需要考虑特征向量的导数：
$$
\frac{\partial \boldsymbol{\phi}_i}{\partial \rho_e} = \sum_{j \neq i} \frac{\boldsymbol{\phi}_j^T \left( \frac{\partial \mathbf{K}}{\partial \rho_e} - \lambda_i \frac{\partial \mathbf{M}}{\partial \rho_e} \right) \boldsymbol{\phi}_i}{\lambda_i - \lambda_j} \boldsymbol{\phi}_j
$$</p>
<h3 id="727">7.2.7 瞬态问题的敏感度</h3>
<p>对于瞬态响应优化，考虑Newmark时间积分：
$$
\mathbf{M}\ddot{\mathbf{U}}^{(n+1)} + \mathbf{C}\dot{\mathbf{U}}^{(n+1)} + \mathbf{K}\mathbf{U}^{(n+1)} = \mathbf{F}^{(n+1)}
$$</p>
<p>使用伴随方法，引入伴随变量 $\boldsymbol{\lambda}(t)$，满足终端条件：
$$
\mathbf{M}\ddot{\boldsymbol{\lambda}} - \mathbf{C}\dot{\boldsymbol{\lambda}} + \mathbf{K}\boldsymbol{\lambda} = -\frac{\partial g}{\partial \mathbf{U}}
$$</p>
<p>其中 $g$ 是时间积分目标函数。</p>
<h3 id="728">7.2.8 热弹性耦合的敏感度</h3>
<p>考虑热应力问题：
$$
\boldsymbol{\sigma} = \mathbf{D}(\boldsymbol{\varepsilon} - \boldsymbol{\varepsilon}_T)
$$</p>
<p>其中热应变：
$$
\boldsymbol{\varepsilon}_T = \alpha \Delta T \begin{bmatrix} 1 \\ 1 \\ 0 \end{bmatrix}
$$</p>
<p>温度场满足：
$$
\mathbf{K}_T \mathbf{T} = \mathbf{Q}
$$</p>
<p>耦合敏感度需要考虑温度场对结构响应的影响：
$$
\frac{\partial c}{\partial \rho_e} = \frac{\partial c}{\partial \mathbf{U}} \frac{\partial \mathbf{U}}{\partial \rho_e} + \frac{\partial c}{\partial \mathbf{T}} \frac{\partial \mathbf{T}}{\partial \rho_e}
$$</p>
<h2 id="73">7.3 过滤技术与棋盘格现象</h2>
<h3 id="731">7.3.1 棋盘格现象的数学解释</h3>
<p>棋盘格模式源于有限元离散化的数值病态。对于双线性四边形单元，棋盘格模式具有人工高刚度。</p>
<p>考虑特征值分析：
$$
\mathbf{K}\boldsymbol{\phi}_i = \lambda_i \mathbf{M}\boldsymbol{\phi}_i
$$</p>
<p>棋盘格模式对应于零能量模式或伪刚体模式。</p>
<h3 id="732">7.3.2 密度过滤</h3>
<p>密度过滤通过加权平均修改密度场：
$$
\tilde{\rho}_e = \frac{\sum_{i \in N_e} w_{ei} v_i \rho_i}{\sum_{i \in N_e} w_{ei} v_i}
$$</p>
<p>权重函数（线性衰减）：
$$
w_{ei} = \max(0, r_{min} - d_{ei})
$$</p>
<p>其中 $r_{min}$ 是过滤半径，$d_{ei}$ 是单元中心距离。</p>
<p>过滤后的敏感度链式法则：
$$
\frac{\partial c}{\partial \rho_i} = \sum_{e \in N_i} \frac{\partial c}{\partial \tilde{\rho}_e} \frac{\partial \tilde{\rho}_e}{\partial \rho_i}
$$</p>
<h3 id="733">7.3.3 敏感度过滤</h3>
<p>直接对敏感度进行过滤：
$$
\frac{\widehat{\partial c}}{\partial \rho_e} = \frac{1}{\max(\gamma, \rho_e) \sum_{i \in N_e} w_{ei}} \sum_{i \in N_e} w_{ei} \rho_i \frac{\partial c}{\partial \rho_i}
$$</p>
<p>其中 $\gamma$ 是小正数，防止除零。</p>
<h3 id="734-heaviside">7.3.4 Heaviside投影</h3>
<p>为获得清晰的0-1设计，使用Heaviside投影：
$$
\bar{\rho}_e = \frac{\tanh(\beta \eta) + \tanh(\beta(\tilde{\rho}_e - \eta))}{\tanh(\beta \eta) + \tanh(\beta(1 - \eta))}
$$</p>
<p>其中 $\beta$ 控制陡度，$\eta$ 是阈值（通常0.5）。</p>
<p>投影的导数：
$$
\frac{\partial \bar{\rho}_e}{\partial \tilde{\rho}_e} = \frac{\beta \text{sech}^2(\beta(\tilde{\rho}_e - \eta))}{\tanh(\beta \eta) + \tanh(\beta(1 - \eta))}
$$</p>
<h3 id="735">7.3.5 鲁棒设计公式</h3>
<p>考虑制造不确定性的三场公式：
$$
\min_{\boldsymbol{\rho}} \quad c(\bar{\boldsymbol{\rho}}^d) + c(\bar{\boldsymbol{\rho}}^i) + c(\bar{\boldsymbol{\rho}}^e)
$$</p>
<p>其中：</p>
<ul>
<li>$\bar{\boldsymbol{\rho}}^d$ = 稀释设计（dilated）</li>
<li>$\bar{\boldsymbol{\rho}}^i$ = 中间设计（intermediate）  </li>
<li>$\bar{\boldsymbol{\rho}}^e$ = 腐蚀设计（eroded）</li>
</ul>
<p>通过不同的投影阈值实现：
$$
\eta^d = 0.5 - \Delta\eta, \quad \eta^i = 0.5, \quad \eta^e = 0.5 + \Delta\eta
$$</p>
<h4 id="_4">统一投影框架</h4>
<p>广义投影函数：
$$
\bar{\rho} = \frac{1}{1 + \exp(-\beta(\tilde{\rho} - \eta))}
$$</p>
<p>三场投影的梯度链：
$$
\frac{\partial c}{\partial \rho_i} = \sum_{j \in \{d,i,e\}} \sum_{k} \frac{\partial c^j}{\partial \bar{\rho}_k^j} \frac{\partial \bar{\rho}_k^j}{\partial \tilde{\rho}_k} \frac{\partial \tilde{\rho}_k}{\partial \rho_i}
$$</p>
<h4 id="_5">制造约束的数学表达</h4>
<p>最小特征尺寸约束（使用几何约束）：
$$
\int_{\Omega} H(\bar{\rho} - \eta) \cdot H(\eta - \bar{\rho}_{\text{dilated}}) \, d\Omega = 0
$$</p>
<p>其中 $H$ 是Heaviside函数，$\bar{\rho}_{\text{dilated}}$ 是膨胀操作后的密度场。</p>
<h3 id="736">7.3.6 非局部过滤算子</h3>
<p>考虑更一般的非局部过滤：
$$
\tilde{\rho}(\mathbf{x}) = \int_{\Omega} w(\mathbf{x}, \mathbf{y}) \rho(\mathbf{y}) \, d\mathbf{y}
$$</p>
<p>高斯核函数：
$$
w(\mathbf{x}, \mathbf{y}) = \frac{1}{(2\pi r^2)^{d/2}} \exp\left(-\frac{|\mathbf{x} - \mathbf{y}|^2}{2r^2}\right)
$$</p>
<p>其中 $d$ 是空间维度，$r$ 是过滤半径。</p>
<h3 id="737-pde">7.3.7 PDE过滤器</h3>
<p>使用Helmholtz方程作为过滤器：
$$
-r^2 \nabla^2 \tilde{\rho} + \tilde{\rho} = \rho
$$</p>
<p>边界条件：
$$
\nabla \tilde{\rho} \cdot \mathbf{n} = 0 \quad \text{on } \partial\Omega
$$</p>
<p>有限元离散化：
$$
(\mathbf{K}_f + \mathbf{M}_f) \tilde{\boldsymbol{\rho}} = \mathbf{M}_f \boldsymbol{\rho}
$$</p>
<p>其中：</p>
<ul>
<li>$\mathbf{K}_f = r^2 \int_{\Omega} \nabla N_i \cdot \nabla N_j \, d\Omega$</li>
<li>$\mathbf{M}_f = \int_{\Omega} N_i N_j \, d\Omega$</li>
</ul>
<h3 id="738">7.3.8 形态学过滤</h3>
<p>数学形态学操作：</p>
<p><strong>腐蚀操作</strong>：
$$
(\rho \ominus B)(\mathbf{x}) = \inf_{\mathbf{b} \in B} \rho(\mathbf{x} + \mathbf{b})
$$</p>
<p><strong>膨胀操作</strong>：
$$
(\rho \oplus B)(\mathbf{x}) = \sup_{\mathbf{b} \in B} \rho(\mathbf{x} - \mathbf{b})
$$</p>
<p><strong>开操作</strong>（先腐蚀后膨胀）：
$$
\rho \circ B = (\rho \ominus B) \oplus B
$$</p>
<p><strong>闭操作</strong>（先膨胀后腐蚀）：
$$
\rho \bullet B = (\rho \oplus B) \ominus B
$$</p>
<p>其中 $B$ 是结构元素。</p>
<h3 id="739">7.3.9 各向异性过滤</h3>
<p>方向依赖的过滤核：
$$
w(\mathbf{x}, \mathbf{y}) = \frac{1}{Z} \exp\left(-(\mathbf{x} - \mathbf{y})^T \mathbf{A}^{-1} (\mathbf{x} - \mathbf{y})\right)
$$</p>
<p>其中 $\mathbf{A}$ 是各向异性张量：
$$
\mathbf{A} = \mathbf{R}(\theta) \begin{bmatrix} r_1^2 &amp; 0 \\ 0 &amp; r_2^2 \end{bmatrix} \mathbf{R}(\theta)^T
$$</p>
<p>$r_1, r_2$ 是主方向的过滤半径，$\theta$ 是旋转角度。</p>
<h2 id="74-mma">7.4 MMA优化器与收敛准则</h2>
<h3 id="741-mma">7.4.1 移动渐近线方法（MMA）</h3>
<p>MMA (Method of Moving Asymptotes) 通过一系列凸子问题逼近原始非凸问题。</p>
<p>原始问题：
$$
\begin{aligned}
\min_{\mathbf{x}} \quad &amp; f_0(\mathbf{x}) \\
\text{s.t.} \quad &amp; f_i(\mathbf{x}) \leq 0, \quad i = 1, ..., m \\
&amp; \alpha_j \leq x_j \leq \beta_j, \quad j = 1, ..., n
\end{aligned}
$$</p>
<p>MMA子问题的近似函数：
$$
f_i^{(k)}(\mathbf{x}) = r_i^{(k)} + \sum_{j=1}^n \left( \frac{p_{ij}^{(k)}}{U_j^{(k)} - x_j} + \frac{q_{ij}^{(k)}}{x_j - L_j^{(k)}} \right)
$$</p>
<p>其中 $L_j^{(k)}$ 和 $U_j^{(k)}$ 是移动渐近线。</p>
<h3 id="742">7.4.2 渐近线更新策略</h3>
<p>渐近线位置的自适应更新：
$$
L_j^{(k)} = x_j^{(k)} - s_j^{(k)}(x_j^{\max} - x_j^{\min})
$$
$$
U_j^{(k)} = x_j^{(k)} + s_j^{(k)}(x_j^{\max} - x_j^{\min})
$$</p>
<p>其中 $s_j^{(k)}$ 是移动限制参数：</p>
<p>$$
s_j^{(k)} = \begin{cases}
0.7 s_j^{(k-1)} &amp; \text{if } (x_j^{(k)} - x_j^{(k-1)})(x_j^{(k-1)} - x_j^{(k-2)}) &lt; 0 \\
1.2 s_j^{(k-1)} &amp; \text{if } (x_j^{(k)} - x_j^{(k-1)})(x_j^{(k-1)} - x_j^{(k-2)}) &gt; 0 \\
s_j^{(k-1)} &amp; \text{otherwise}
\end{cases}
$$</p>
<h3 id="743">7.4.3 系数计算</h3>
<p>根据函数值和梯度计算MMA系数：</p>
<p>当 $\frac{\partial f_i}{\partial x_j} &gt; 0$：
$$
p_{ij}^{(k)} = (U_j^{(k)} - x_j^{(k)})^2 \frac{\partial f_i}{\partial x_j}\bigg|_{x^{(k)}}, \quad q_{ij}^{(k)} = 0
$$</p>
<p>当 $\frac{\partial f_i}{\partial x_j} &lt; 0$：
$$
p_{ij}^{(k)} = 0, \quad q_{ij}^{(k)} = -(x_j^{(k)} - L_j^{(k)})^2 \frac{\partial f_i}{\partial x_j}\bigg|_{x^{(k)}}
$$</p>
<p>常数项：
$$
r_i^{(k)} = f_i(x^{(k)}) - \sum_{j=1}^n \left( \frac{p_{ij}^{(k)}}{U_j^{(k)} - x_j^{(k)}} + \frac{q_{ij}^{(k)}}{x_j^{(k)} - L_j^{(k)}} \right)
$$</p>
<h3 id="744-kkt">7.4.4 对偶问题与KKT条件</h3>
<p>MMA子问题的拉格朗日函数：
$$
\mathcal{L} = f_0^{(k)}(\mathbf{x}) + \sum_{i=1}^m \lambda_i f_i^{(k)}(\mathbf{x}) + \sum_{j=1}^n (\mu_j^- (\alpha_j - x_j) + \mu_j^+ (x_j - \beta_j))
$$</p>
<p>KKT条件：
$$
\frac{\partial \mathcal{L}}{\partial x_j} = 0, \quad j = 1, ..., n
$$</p>
<p>显式解：
$$
x_j = \frac{\sqrt{p_j^*(\lambda)} - \sqrt{q_j^*(\lambda)} + L_j \sqrt{q_j^*(\lambda)/p_j^*(\lambda)} + U_j}{\sqrt{q_j^*(\lambda)/p_j^*(\lambda)} + 1}
$$</p>
<p>其中：
$$
p_j^*(\lambda) = p_{0j} + \sum_{i=1}^m \lambda_i p_{ij}, \quad q_j^*(\lambda) = q_{0j} + \sum_{i=1}^m \lambda_i q_{ij}
$$</p>
<h3 id="745">7.4.5 内点法求解对偶问题</h3>
<p>对偶问题：
$$
\max_{\lambda \geq 0} \quad \psi(\lambda)
$$</p>
<p>使用内点牛顿法，引入障碍函数：
$$
\psi_\mu(\lambda) = \psi(\lambda) - \mu \sum_{i=1}^m \ln(\lambda_i)
$$</p>
<p>牛顿方向：
$$
\nabla^2 \psi_\mu \Delta\lambda = -\nabla \psi_\mu
$$</p>
<h3 id="746">7.4.6 收敛准则</h3>
<p>多准则收敛判定：</p>
<ol>
<li>
<p><strong>KKT残差</strong>：
$$
r_{KKT} = \max\left\{ \left|\nabla_x \mathcal{L}\right|_\infty, \max_i |\min(0, -f_i)|, \max_i |\lambda_i f_i| \right\} &lt; \epsilon_{KKT}
$$</p>
</li>
<li>
<p><strong>设计变量变化</strong>：
$$
\Delta x = \frac{|\mathbf{x}^{(k+1)} - \mathbf{x}^{(k)}|_2}{|\mathbf{x}^{(k)}|_2} &lt; \epsilon_x
$$</p>
</li>
<li>
<p><strong>目标函数变化</strong>：
$$
\Delta f = \frac{|f_0^{(k+1)} - f_0^{(k)}|}{|f_0^{(k)}|} &lt; \epsilon_f
$$</p>
</li>
<li>
<p><strong>灰度指标</strong>（0-1性）：
$$
M_{nd} = \frac{4 \sum_{e=1}^N \rho_e(1-\rho_e)}{N} &lt; \epsilon_{gray}
$$</p>
</li>
</ol>
<p>典型阈值：$\epsilon_{KKT} = 10^{-6}$, $\epsilon_x = 10^{-3}$, $\epsilon_f = 10^{-4}$, $\epsilon_{gray} = 0.01$</p>
<h4 id="_6">自适应收敛准则</h4>
<p>动态调整收敛阈值：
$$
\epsilon^{(k+1)} = \begin{cases}
\epsilon^{(k)} / \gamma &amp; \text{if } r^{(k)} &lt; \alpha \epsilon^{(k)} \\
\epsilon^{(k)} \cdot \gamma &amp; \text{if } r^{(k)} &gt; \beta \epsilon^{(k)} \\
\epsilon^{(k)} &amp; \text{otherwise}
\end{cases}
$$</p>
<p>其中 $\gamma = 1.5$，$\alpha = 0.1$，$\beta = 0.9$。</p>
<h3 id="747-gcmma">7.4.7 GCMMA扩展</h3>
<p>广义MMA（GCMMA）增加了二阶项：
$$
f_i^{(k)}(\mathbf{x}) = r_i^{(k)} + \sum_{j=1}^n \left( \frac{p_{ij}^{(k)}}{U_j^{(k)} - x_j} + \frac{q_{ij}^{(k)}}{x_j - L_j^{(k)}} \right) + \sum_{j=1}^n \sum_{l=1}^n x_j A_{ijl}^{(k)} x_l
$$</p>
<p>二阶项系数通过拟牛顿方法更新：
$$
\mathbf{A}^{(k+1)} = \mathbf{A}^{(k)} + \frac{\mathbf{y}\mathbf{y}^T}{\mathbf{y}^T\mathbf{s}} - \frac{\mathbf{A}^{(k)}\mathbf{s}\mathbf{s}^T\mathbf{A}^{(k)}}{\mathbf{s}^T\mathbf{A}^{(k)}\mathbf{s}}
$$</p>
<p>其中 $\mathbf{s} = \mathbf{x}^{(k+1)} - \mathbf{x}^{(k)}$，$\mathbf{y} = \nabla f^{(k+1)} - \nabla f^{(k)}$。</p>
<h3 id="748">7.4.8 全局收敛性保证</h3>
<p>引入信赖域约束：
$$
|\mathbf{x} - \mathbf{x}^{(k)}|_\infty \leq \Delta^{(k)}
$$</p>
<p>信赖域半径更新：
$$
\Delta^{(k+1)} = \begin{cases}
\min(2\Delta^{(k)}, \Delta_{\max}) &amp; \text{if } \rho^{(k)} &gt; 0.75 \\
\Delta^{(k)} &amp; \text{if } 0.25 \leq \rho^{(k)} \leq 0.75 \\
0.5\Delta^{(k)} &amp; \text{if } \rho^{(k)} &lt; 0.25
\end{cases}
$$</p>
<p>其中 $\rho^{(k)} = \frac{f(\mathbf{x}^{(k)}) - f(\mathbf{x}^{(k+1)})}{q(\mathbf{x}^{(k)}) - q(\mathbf{x}^{(k+1)})}$ 是实际下降与预测下降的比值。</p>
<h3 id="749-mma">7.4.9 并行MMA实现</h3>
<p>对于大规模问题，MMA子问题可以分解：</p>
<p><strong>分离变量</strong>：
$$
\min_{\mathbf{x}, \mathbf{y}, \mathbf{z}} \sum_{j=1}^n \left( \frac{p_{0j}^+ + \sum_{i=1}^m \lambda_i p_{ij}^+}{U_j - x_j} + \frac{q_{0j}^+ + \sum_{i=1}^m \lambda_i q_{ij}^+}{x_j - L_j} \right) + \sum_{i=1}^m \lambda_i z_i
$$</p>
<p>约束：
$$
\sum_{j=1}^n \left( \frac{p_{ij}}{U_j - x_j} + \frac{q_{ij}}{x_j - L_j} \right) - z_i + y_i^2 = b_i
$$</p>
<p><strong>并行策略</strong>：</p>
<ol>
<li>变量分组：$\mathbf{x} = [\mathbf{x}_1, \mathbf{x}_2, ..., \mathbf{x}_P]$</li>
<li>处理器 $p$ 负责 $\mathbf{x}_p$ 的更新</li>
<li>使用全局归约操作计算约束值</li>
<li>主处理器更新拉格朗日乘子</li>
</ol>
<h3 id="7410">7.4.10 稳定化技术</h3>
<p><strong>移动限制</strong>：
$$
\max(\alpha_j, x_j^{(k)} - 0.1(x_j^{\max} - x_j^{\min})) \leq x_j^{(k+1)} \leq \min(\beta_j, x_j^{(k)} + 0.1(x_j^{\max} - x_j^{\min}))
$$</p>
<p><strong>阻尼更新</strong>：
$$
x_j^{(k+1)} = (1 - \omega) x_j^{(k)} + \omega x_j^{*}
$$</p>
<p>其中 $\omega \in (0, 1]$ 是阻尼因子，$x_j^{*}$ 是MMA子问题的解。</p>
<h2 id="75">7.5 应力约束与疲劳优化</h2>
<h3 id="751">7.5.1 应力约束的挑战</h3>
<p>应力约束拓扑优化面临的主要挑战：</p>
<ol>
<li><strong>奇异性</strong>：$\rho \to 0$ 时应力趋于无穷</li>
<li><strong>局部性</strong>：大量局部约束（每个单元）</li>
<li><strong>非线性</strong>：应力-密度关系高度非线性</li>
</ol>
<h3 id="752-qp">7.5.2 qp松弛方法</h3>
<p>松弛的应力约束：
$$
\sigma_{vm,e} \leq \frac{\sigma_{allow}}{\rho_e^q}
$$</p>
<p>其中 $q \in (0, 1)$ 是松弛参数（通常 $q = 0.5$）。</p>
<p>等效形式：
$$
\rho_e^q \sigma_{vm,e} \leq \sigma_{allow}
$$</p>
<h3 id="753">7.5.3 应力聚合函数</h3>
<p>P-norm聚合：
$$
\sigma_{PN} = \left( \sum_{e=1}^N \left(\frac{\sigma_{vm,e}}{\sigma_{allow}}\right)^P \right)^{1/P}
$$</p>
<p>KS (Kreisselmeier-Steinhauser) 函数：
$$
\sigma_{KS} = \frac{1}{\xi} \ln\left( \sum_{e=1}^N \exp(\xi \sigma_{vm,e}/\sigma_{allow}) \right)
$$</p>
<p>其中 $P$ 或 $\xi$ 是聚合参数。</p>
<h3 id="754">7.5.4 局部应力约束的处理</h3>
<p>块聚合策略：
$$
\max_{e \in B_k} \sigma_{vm,e} \leq \sigma_{allow}, \quad k = 1, ..., N_B
$$</p>
<p>其中 $B_k$ 是第 $k$ 个块。</p>
<p>自适应约束删除：
$$
\mathcal{A} = \{e : \sigma_{vm,e} &gt; \alpha \sigma_{allow}\}
$$</p>
<p>只保留活跃集 $\mathcal{A}$ 中的约束。</p>
<h3 id="755">7.5.5 疲劳优化</h3>
<p>高周疲劳的Basquin定律：
$$
N_f = \left(\frac{\sigma_a}{\sigma'_f}\right)^{-1/b}
$$</p>
<p>其中：</p>
<ul>
<li>$N_f$ 是疲劳寿命（循环次数）</li>
<li>$\sigma_a$ 是应力幅值</li>
<li>$\sigma'_f$ 是疲劳强度系数</li>
<li>$b$ 是疲劳强度指数</li>
</ul>
<p>修正的Goodman准则：
$$
\frac{\sigma_a}{S_e} + \frac{\sigma_m}{S_{ut}} = \frac{1}{n}
$$</p>
<p>其中：</p>
<ul>
<li>$S_e$ 是耐久极限</li>
<li>$S_{ut}$ 是极限强度</li>
<li>$n$ 是安全系数</li>
</ul>
<h3 id="756">7.5.6 多载荷工况</h3>
<p>考虑 $M$ 个载荷工况：
$$
\min_{\boldsymbol{\rho}} \quad \sum_{i=1}^M w_i c_i(\boldsymbol{\rho})
$$</p>
<p>其中 $w_i$ 是权重系数。</p>
<p>最坏情况设计：
$$
\min_{\boldsymbol{\rho}} \quad \max_{i=1,...,M} c_i(\boldsymbol{\rho})
$$</p>
<p>使用辅助变量重构：
$$
\begin{aligned}
\min_{\boldsymbol{\rho}, z} \quad &amp; z \\
\text{s.t.} \quad &amp; c_i(\boldsymbol{\rho}) \leq z, \quad i = 1, ..., M
\end{aligned}
$$</p>
<h3 id="757">7.5.7 应力集中的网格自适应</h3>
<p>误差估计器：
$$
\eta_e = h_e |\nabla \sigma_{vm}|_{L^2(\Omega_e)}
$$</p>
<p>网格细化准则：
$$
\text{refine if } \eta_e &gt; \theta \max_i \eta_i
$$</p>
<p>其中 $\theta \in (0, 1)$ 是细化阈值。</p>
<h2 id="_7">本章小结</h2>
<p>本章系统介绍了拓扑优化的基础理论和数值方法：</p>
<h3 id="_8">核心概念</h3>
<ul>
<li><strong>SIMP方法</strong>：通过幂律插值 $E(\rho) = \rho^p E_0$ 实现材料分布的连续化</li>
<li><strong>敏感度分析</strong>：伴随方法高效计算 $\frac{\partial c}{\partial \rho_e} = -p\rho_e^{p-1} \mathbf{u}_e^T \mathbf{k}_e^0 \mathbf{u}_e$</li>
<li><strong>过滤技术</strong>：密度过滤、敏感度过滤和Heaviside投影消除数值不稳定性</li>
<li><strong>MMA优化器</strong>：通过移动渐近线构造凸子问题序列</li>
<li><strong>应力约束</strong>：qp松弛和聚合函数处理局部应力约束</li>
</ul>
<h3 id="_9">关键公式汇总</h3>
<ol>
<li>
<p><strong>拓扑优化标准形式</strong>：
   $$\min_{\boldsymbol{\rho}} c(\boldsymbol{\rho}) \text{ s.t. } \mathbf{K}\mathbf{U} = \mathbf{F}, V(\boldsymbol{\rho}) \leq V_0$$</p>
</li>
<li>
<p><strong>密度过滤</strong>：
$$\tilde{\rho}_e = \frac{\sum_{i \in N_e} w_{ei} v_i \rho_i}{\sum_{i \in N_e} w_{ei} v_i}$$</p>
</li>
<li>
<p><strong>MMA近似函数</strong>：
$$f_i^{(k)}(\mathbf{x}) = r_i^{(k)} + \sum_{j=1}^n \left( \frac{p_{ij}^{(k)}}{U_j^{(k)} - x_j} + \frac{q_{ij}^{(k)}}{x_j - L_j^{(k)}} \right)$$</p>
</li>
<li>
<p><strong>应力聚合</strong>：
$$\sigma_{KS} = \frac{1}{\xi} \ln\left( \sum_{e=1}^N \exp(\xi \sigma_{vm,e}/\sigma_{allow}) \right)$$</p>
</li>
</ol>
<h3 id="_10">实践要点</h3>
<ul>
<li>惩罚因子 $p$ 通常取3，过滤半径 $r_{min}$ 取1.5倍单元尺寸</li>
<li>MMA需要合理设置移动限制和渐近线更新策略</li>
<li>应力约束问题建议使用块聚合减少约束数量</li>
<li>多载荷工况优化需要权衡不同工况的重要性</li>
</ul>
<h2 id="_11">练习题</h2>
<h3 id="_12">基础题</h3>
<p><strong>习题7.1</strong> 证明SIMP插值下，当 $p &gt; 1$ 时，中间密度（$0 &lt; \rho &lt; 1$）的材料效率低于线性插值。</p>
<details>
<summary>提示</summary>
<p>比较 $\rho^p$ 和 $\rho$ 在 $0 &lt; \rho &lt; 1$ 区间的大小关系。</p>
</details>
<details>
<summary>答案</summary>
<p>当 $p &gt; 1$ 且 $0 &lt; \rho &lt; 1$ 时，有 $\rho^p &lt; \rho$。</p>
<p>证明：设 $f(\rho) = \rho - \rho^p$，则：
$$f'(\rho) = 1 - p\rho^{p-1}$$
当 $\rho &lt; 1$ 时，$\rho^{p-1} &lt; 1$，因此当 $\rho &lt; 1/p^{1/(p-1)}$ 时，$f'(\rho) &gt; 0$。</p>
<p>由于 $f(0) = 0$ 且 $f(1) = 0$，函数在 $(0, 1)$ 区间先增后减，且 $f(\rho) &gt; 0$。</p>
<p>因此 $\rho^p &lt; \rho$，说明SIMP惩罚了中间密度。</p>
</details>
<p><strong>习题7.2</strong> 推导二维四节点四边形单元的敏感度计算公式，假设单元厚度为 $t$，材料弹性模量为 $E$，泊松比为 $\nu$。</p>
<details>
<summary>提示</summary>
<p>从单元应变能出发，利用链式法则求导。</p>
</details>
<details>
<summary>答案</summary>
<p>单元应变能：
$$U_e = \frac{1}{2}\mathbf{u}_e^T \mathbf{k}_e \mathbf{u}_e = \frac{1}{2}\rho_e^p \mathbf{u}_e^T \mathbf{k}_e^0 \mathbf{u}_e$$
柔度对密度的导数：
$$\frac{\partial c}{\partial \rho_e} = -\frac{\partial U_e}{\partial \rho_e} = -\frac{p}{2}\rho_e^{p-1} \mathbf{u}_e^T \mathbf{k}_e^0 \mathbf{u}_e$$
考虑对称性，最终：
$$\frac{\partial c}{\partial \rho_e} = -p\rho_e^{p-1} \mathbf{u}_e^T \mathbf{k}_e^0 \mathbf{u}_e$$</p>
</details>
<p><strong>习题7.3</strong> 给定过滤半径 $r_{min} = 1.5h$（$h$ 为单元尺寸），计算2D规则网格中心单元的过滤权重矩阵。</p>
<details>
<summary>提示</summary>
<p>使用线性衰减权重函数 $w = \max(0, r_{min} - d)$。</p>
</details>
<details>
<summary>答案</summary>
<p>对于单元间距为 $h$ 的规则网格，中心单元到邻居的距离：</p>
<ul>
<li>直接相邻：$d = h$</li>
<li>对角相邻：$d = \sqrt{2}h \approx 1.414h$</li>
</ul>
<p>权重计算：</p>
<ul>
<li>中心单元：$w_0 = 1.5h - 0 = 1.5h$</li>
<li>直接相邻（4个）：$w_1 = 1.5h - h = 0.5h$</li>
<li>对角相邻（4个）：$w_2 = 1.5h - 1.414h = 0.086h$</li>
</ul>
<p>归一化权重矩阵：
$$\mathbf{W} = \frac{1}{3.844h} \begin{bmatrix}
0.086h &amp; 0.5h &amp; 0.086h \\
0.5h &amp; 1.5h &amp; 0.5h \\
0.086h &amp; 0.5h &amp; 0.086h
\end{bmatrix}$$</p>
</details>
<h3 id="_13">挑战题</h3>
<p><strong>习题7.4</strong> 考虑带有频率约束的拓扑优化问题，推导第一阶固有频率对设计变量的敏感度。</p>
<details>
<summary>提示</summary>
<p>从广义特征值问题出发，使用伴随方法。</p>
</details>
<details>
<summary>答案</summary>
<p>广义特征值问题：
$$(\mathbf{K} - \omega^2 \mathbf{M})\boldsymbol{\phi} = \mathbf{0}$$
对 $\rho_e$ 求导：
$$\left(\frac{\partial \mathbf{K}}{\partial \rho_e} - \omega^2 \frac{\partial \mathbf{M}}{\partial \rho_e} - 2\omega\frac{\partial \omega}{\partial \rho_e}\mathbf{M}\right)\boldsymbol{\phi} + (\mathbf{K} - \omega^2 \mathbf{M})\frac{\partial \boldsymbol{\phi}}{\partial \rho_e} = \mathbf{0}$$
左乘 $\boldsymbol{\phi}^T$，利用质量归一化 $\boldsymbol{\phi}^T\mathbf{M}\boldsymbol{\phi} = 1$：
$$\frac{\partial \omega^2}{\partial \rho_e} = \boldsymbol{\phi}^T \left(\frac{\partial \mathbf{K}}{\partial \rho_e} - \omega^2 \frac{\partial \mathbf{M}}{\partial \rho_e}\right) \boldsymbol{\phi}$$
对于SIMP插值：
$$\frac{\partial \omega^2}{\partial \rho_e} = p\rho_e^{p-1}\boldsymbol{\phi}_e^T\mathbf{k}_e^0\boldsymbol{\phi}_e - \omega^2\boldsymbol{\phi}_e^T\mathbf{m}_e^0\boldsymbol{\phi}_e$$</p>
</details>
<p><strong>习题7.5</strong> 分析MMA算法中渐近线位置对收敛性的影响，给出最优渐近线选择策略。</p>
<details>
<summary>提示</summary>
<p>考虑Hessian矩阵的正定性和曲率匹配。</p>
</details>
<details>
<summary>答案</summary>
<p>MMA近似的Hessian矩阵：
$$H_{jj} = \frac{2p_j}{(U_j - x_j)^3} + \frac{2q_j}{(x_j - L_j)^3}$$
为保证正定性和良好收敛，渐近线应满足：</p>
<ol>
<li>
<p><strong>曲率匹配条件</strong>：
$$\frac{1}{U_j - x_j} + \frac{1}{x_j - L_j} \approx \frac{|\nabla^2 f|}{|\nabla f|}$$</p>
</li>
<li>
<p><strong>自适应策略</strong>：
   - 振荡时（方向改变）：收缩渐近线，$s \leftarrow 0.7s$
   - 单调时（方向不变）：扩张渐近线，$s \leftarrow 1.2s$</p>
</li>
<li>
<p><strong>最优初始设置</strong>：
$$L_j^{(0)} = x_j^{(0)} - 0.5(x_j^{\max} - x_j^{\min})$$
   $$U_j^{(0)} = x_j^{(0)} + 0.5(x_j^{\max} - x_j^{\min})$$
这种策略平衡了局部收敛速度和全局稳定性。</p>
</li>
</ol>
</details>
<p><strong>习题7.6</strong> 设计一个自适应Heaviside投影策略，使得优化过程从连续松弛逐渐过渡到离散设计。</p>
<details>
<summary>提示</summary>
<p>考虑continuation方法，逐步增加投影陡度参数 $\beta$。</p>
</details>
<details>
<summary>答案</summary>
<p>自适应投影策略：</p>
<ol>
<li>
<p><strong>初始阶段</strong>（迭代1-50）：
$$\beta = 1, \quad \text{无投影或弱投影}$$</p>
</li>
<li>
<p><strong>过渡阶段</strong>（迭代51-150）：
$$\beta^{(k)} = \min(1 + 0.1(k-50), 8)$$</p>
</li>
<li>
<p><strong>强化阶段</strong>（迭代151-250）：
$$\beta^{(k)} = \min(8 \times 2^{(k-150)/50}, 64)$$</p>
</li>
<li>
<p><strong>收敛准则调整</strong>：</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span>灰度指标<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>.<span class="mi">05</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span>:
<span class="w">    </span>β<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">min</span><span class="ss">(</span><span class="mi">2</span>β,<span class="w"> </span><span class="mi">64</span><span class="ss">)</span>
</code></pre></div>

<ol start="5">
<li><strong>稳定性保护</strong>：</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span>目标函数振荡<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="o">%</span>:
<span class="w">    </span>β<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">max</span><span class="ss">(</span>β<span class="o">/</span><span class="mi">2</span>,<span class="w"> </span><span class="mi">1</span><span class="ss">)</span>
</code></pre></div>

<p>这种策略确保：</p>
<ul>
<li>早期探索设计空间</li>
<li>中期逐渐清晰化</li>
<li>后期强制0-1设计</li>
<li>避免过早收敛到局部最优</li>
</ul>
</details>
<p><strong>习题7.7</strong> 推导考虑几何非线性的拓扑优化敏感度公式，假设采用Total Lagrangian格式。</p>
<details>
<summary>提示</summary>
<p>考虑切线刚度矩阵和几何刚度矩阵的贡献。</p>
</details>
<details>
<summary>答案</summary>
<p>几何非线性平衡方程：
$$\mathbf{F}_{int}(\mathbf{U}, \boldsymbol{\rho}) = \mathbf{F}_{ext}$$
切线刚度矩阵：
$$\mathbf{K}_T = \mathbf{K}_L + \mathbf{K}_G + \mathbf{K}_{u}$$
其中：</p>
<ul>
<li>$\mathbf{K}_L$：线性刚度矩阵</li>
<li>$\mathbf{K}_G$：几何刚度矩阵</li>
<li>$\mathbf{K}_{u}$：初始位移刚度矩阵</li>
</ul>
<p>敏感度（使用伴随方法）：</p>
<ol>
<li>
<p>伴随方程：
$$\mathbf{K}_T^T \boldsymbol{\lambda} = -\frac{\partial c}{\partial \mathbf{U}}$$</p>
</li>
<li>
<p>目标函数敏感度：
$$\frac{\partial c}{\partial \rho_e} = \frac{\partial c}{\partial \mathbf{U}}\frac{\partial \mathbf{U}}{\partial \rho_e} + \boldsymbol{\lambda}^T \frac{\partial \mathbf{F}_{int}}{\partial \rho_e}$$</p>
</li>
<li>
<p>内力对密度的导数：
$$\frac{\partial \mathbf{F}_{int}}{\partial \rho_e} = p\rho_e^{p-1} \int_{\Omega_e} \mathbf{B}_L^T \mathbf{S} \, d\Omega$$</p>
</li>
</ol>
<p>其中 $\mathbf{S}$ 是第二Piola-Kirchhoff应力，$\mathbf{B}_L$ 是大变形应变-位移矩阵。</p>
<p>最终敏感度需要通过Newton-Raphson迭代中的增量求解获得。</p>
</details>
<h2 id="_14">常见陷阱与错误</h2>
<h3 id="1">1. 数值不稳定性</h3>
<ul>
<li><strong>问题</strong>：未加过滤导致棋盘格模式</li>
<li><strong>解决</strong>：始终使用密度或敏感度过滤，过滤半径至少1.2倍单元尺寸</li>
</ul>
<h3 id="2">2. 初始设计影响</h3>
<ul>
<li><strong>问题</strong>：均匀初始密度可能导致局部最优</li>
<li><strong>解决</strong>：尝试不同初始设计，如随机扰动或基于经验的非均匀分布</li>
</ul>
<h3 id="3">3. 惩罚参数选择</h3>
<ul>
<li><strong>问题</strong>：$p$ 值过大导致收敛困难</li>
<li><strong>解决</strong>：使用continuation方法，从 $p=1$ 开始逐步增加到 $p=3$</li>
</ul>
<h3 id="4">4. 体积约束过严</h3>
<ul>
<li><strong>问题</strong>：体积分数过小导致无可行解</li>
<li><strong>解决</strong>：从较大体积分数开始，逐步减小</li>
</ul>
<h3 id="5-mma">5. MMA参数调试</h3>
<ul>
<li><strong>问题</strong>：移动限制过大导致振荡</li>
<li><strong>解决</strong>：自适应调整移动限制，监控目标函数历史</li>
</ul>
<h3 id="6">6. 应力约束处理</h3>
<ul>
<li><strong>问题</strong>：直接使用局部应力约束导致计算量爆炸</li>
<li><strong>解决</strong>：使用聚合函数或自适应约束删除策略</li>
</ul>
<h3 id="7_1">7. 网格依赖性</h3>
<ul>
<li><strong>问题</strong>：不同网格密度得到不同拓扑</li>
<li><strong>解决</strong>：固定过滤半径的物理尺寸，而非单元数量</li>
</ul>
<h3 id="8">8. 灰度单元处理</h3>
<ul>
<li><strong>问题</strong>：优化结果含大量中间密度</li>
<li><strong>解决</strong>：增加惩罚因子或使用Heaviside投影</li>
</ul>
<h2 id="_15">最佳实践检查清单</h2>
<h3 id="_16">问题定义阶段</h3>
<ul>
<li>[ ] 明确定义设计域、载荷和边界条件</li>
<li>[ ] 选择合适的目标函数（柔度、应力、频率等）</li>
<li>[ ] 确定合理的体积约束或其他约束条件</li>
<li>[ ] 评估是否需要考虑制造约束</li>
</ul>
<h3 id="_17">数值实现阶段</h3>
<ul>
<li>[ ] 选择合适的单元类型和网格密度</li>
<li>[ ] 实现敏感度分析并验证（有限差分对比）</li>
<li>[ ] 配置过滤方案（类型、半径）</li>
<li>[ ] 选择优化算法（MMA、OC、GCMMA）</li>
<li>[ ] 设置合理的收敛准则</li>
</ul>
<h3 id="_18">优化过程监控</h3>
<ul>
<li>[ ] 记录目标函数和约束历史</li>
<li>[ ] 监控灰度指标变化</li>
<li>[ ] 检查KKT条件满足程度</li>
<li>[ ] 观察设计演化过程</li>
<li>[ ] 识别和处理数值问题</li>
</ul>
<h3 id="_19">后处理阶段</h3>
<ul>
<li>[ ] 提取清晰的0-1设计</li>
<li>[ ] 验证结构性能（FEA重分析）</li>
<li>[ ] 检查制造可行性</li>
<li>[ ] 进行网格无关性研究</li>
<li>[ ] 评估对参数变化的敏感性</li>
</ul>
<h3 id="_20">验证与确认</h3>
<ul>
<li>[ ] 基准问题测试（悬臂梁、MBB梁）</li>
<li>[ ] 与解析解或文献结果对比</li>
<li>[ ] 参数研究（惩罚因子、过滤半径）</li>
<li>[ ] 鲁棒性分析（初始设计、网格密度）</li>
<li>[ ] 计算效率评估</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="./chapter6.html" class="nav-link prev">← 第6章：有限元方法与结构分析</a><a href="./chapter8.html" class="nav-link next">第8章：高级拓扑优化 →</a></nav>
        </main>
    </div>
</body>
</html>